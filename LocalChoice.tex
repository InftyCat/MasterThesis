
\section{Local Choice}
%One of the goals of this chapter is to show descent for types admitting a $\bT$-(c)atlas. 
%Recall \ref{think:getRidOfLocalChoice}.
%In this section let $\bT$ denote a topology finer than the zariski topology.
In this section let $\bT$ denote a topology finer than the zariski topology.
\begin{definition}
	Let \Cov be a class of morphisms (which we think of $n$-atlasses of some $n$), containing $\bT$-atlas, (stable under pullback NECESSARY TODO?)
	A type $S$ has \emph{local choice} wrt \Cov if for any $\bT$ -surjective map $X \to Y$ and any map $f : S \to Y$ there exists a map  $p' : S' \to S$ in \Cov and a commutative diagram
	% https://q.uiver.app/#q=WzAsNCxbMCwwLCJUJyJdLFswLDEsIlQiXSxbMSwwLCJYIl0sWzEsMSwiWSJdLFsxLDNdLFsyLDNdLFswLDIsIiIsMix7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFswLDFdXQ==
	% https://q.uiver.app/#q=WzAsNCxbMCwwLCJUJyJdLFswLDEsIlQiXSxbMSwwLCJYIl0sWzEsMSwiWSJdLFsxLDNdLFsyLDMsInAiLDJdLFswLDIsIiIsMix7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFswLDFdXQ==
	\[\begin{tikzcd}
		{S'} & X \\
		S & Y
		\arrow[dashed, from=1-1, to=1-2]
		\arrow[from=1-1, to=2-1]
		\arrow["p"', from=1-2, to=2-2]
		\arrow["f",from=2-1, to=2-2]
	\end{tikzcd}\]
	%We say $S$ has affine local choice, if one can arrange $S'$ to be affine.
\end{definition}
\begin{prop}{\label{prop:LocalChoice}}
	%Let $\bT$ be a finer topology than the zariski topology.
	Assume that \Cov is stable under composition and that Zariski-covers are in \Cov.
	$S$ has  $\bT$-local choice wrt \Cov if it has an $\Cov$-atlas, i.e. there exists an affine scheme $\hat{S}$ with a map $g : \hat{S} \to S$ in \Cov. %, satisfying local choice wrt \Cov
\end{prop}
\begin{proof}
	%We may assume that $f = \id_S$.
	By stability under composition of \Cov, We may assume that $g : \hat{S} \to S$ is the identity.
	As $p$ is $\bT$-surjective, for any $x : S$ there merely is a $\Spec B_x \in T$  and a map $\Spec B_x \to \| \fib_p (x) \| $. 
	By ZLC  (\ref{ZLCGivesZariski}), there exists a Zariski atlas $S' \overset{p'}{\to} S$ and a term in
	\[\prod_{x : S'} \sum_{\Spec B_x \in T} \Spec B_x \to \| \fib_p (fp' x)\| \]
	
	By setting 
	\[(S'' := \sum_{x : S'} \Spec B_x) \overset{\pi}{\longrightarrow} S' \]
	
	the projection, we are now in the situation that for any $t : S''$ we merely have a point in $\fib_p((p''(t)))$ and $S'' \to S'$ is a $\bT$-cover, thus it is in \Cov. Moreover, $S''$ is affine, as it is a dependent sum of affines. By replacing $S''$ again with a Zariski cover we find a lift $S'' \to X$     
	making
	% https://q.uiver.app/#q=WzAsNSxbMCwwLCJUJyciXSxbMCwxLCJUJyJdLFswLDIsIlQiXSxbMSwyLCJYIl0sWzEsMCwiWSJdLFswLDFdLFsyLDMsImYiXSxbNCwzLCJwIiwyXSxbMCw0XSxbMSwyLCJwJyJdXQ==
	\[\begin{tikzcd}
		{S''} & X \\
		{S'} \\
		S & S
		\arrow[from=1-1, to=1-2]
		\arrow[from=1-1, to=2-1]
		\arrow["p"', from=1-2, to=3-2]
		\arrow["{p'}", from=2-1, to=3-1]
		\arrow["\id", from=3-1, to=3-2]
	\end{tikzcd}\]
	commute. Now $S'' \to S' \to S$ as the composition of Zariski-covers and \Cover is a \Cover \details as desired.
	%For the general case, the previous proof is enough. \todo
\end{proof}
%\begin{prop}{\label{prop:LocalChoice}}
%	%Let $\bT$ be a finer topology than the zariski topology.
%	Assume that \Cov is stable under composition. %and that Zariski-covers are in \Cov.
%	\begin{itemize}
%		\item If $\hat S \to S$ is a \Cover and $\hat S$ has $\bT$-local choice, then $S$ has $\bT$-local choice. 
%		\item Affine schemes have $\bT$-local choice.
%		\item Any type admitting a \Cov - Atlas $\Spec A \to S$ has $\bT$-local choice.
%	\end{itemize}
%%	$S$ has  $\bT$-local choice wrt \Cov if it has a projective \Cover, i.e. there exists a projective (or, assuming ZLC, affine scheme resp.)  $\hat{S}$ with a map $g : \hat{S} \to S$ in \Cov. %, satisfying local choice wrt \Cov
%\end{prop}
%\begin{proof}
%	%We may assume that $f = \id_S$.
%	The first point follows from stability under composition of \Cov. %  We may assume that $g : \hat{S} \to S$ is the identity.
%	the third point follows from the second. 
%	By the first point, we may assume that $S$ is affine.
%	As $p$ is $\bT$-surjective, for any $x : S$ there merely is a $\Spec B_x \in T$  and a map $\Spec B_x \to \| \fib_p (x) \| $. 
%	%Claim: No matter on the assumptions (on $S = \hat{S}$), there exists a Zariski cover $S' \overset{p'}{\to} S$ with $S'$ projective (affine resp.) 
%	As $S$ is projective, we have a term in
%	\[\prod_{x : S} \sum_{\Spec B_x \in T} \Spec B_x \to \| \fib_p (f x)\| \]
%	%	Proof: In the case of projectivity, just use $p' = \id_S$ and in the case of having ZLC and $S$ beeing affine, use ZLC (\ref{ZLCGivesZariski}). \qed(Claim)\\    
%	By setting 
%	\[(S' := \sum_{x : S} \Spec B_x) \overset{\pi}{\longrightarrow} S \]
%	
%	the projection, we are now in the situation that for any $t : S'$ we merely have a point in $\fib_p((p'(t)))$ and $S' \to S$ is a $\bT$-cover, thus it is in \Cov. Moreover, $S'$ is affine, as it is a dependent sum of affines. Hence again we now can find a lift $S' \to X$ %By replacing $S''$ again with a Zariski cover we find a lift $S'' \to X$     
%	making
%% https://q.uiver.app/#q=WzAsNCxbMCwwLCJTJyJdLFswLDEsIlMiXSxbMSwxLCJYIl0sWzEsMCwiWSJdLFsxLDIsImYiXSxbMywyLCJwIiwyXSxbMCwzXSxbMCwxLCJwJyIsMl1d
%\[\begin{tikzcd}
%	{S'} & Y \\
%	S & X
%	\arrow[from=1-1, to=1-2]
%	\arrow["{p'}"', from=1-1, to=2-1]
%	\arrow["p"', from=1-2, to=2-2]
%	\arrow["f", from=2-1, to=2-2]
%\end{tikzcd}\]	commute. %Now $S'' \to S' \to S$ as the composition of Zariski-covers and \Cover is a \Cover \details as desired.
%	%For the general case, the previous proof is enough. \todo
%\end{proof}
The next lemma shows, that the class of types equipped with a $\bT$-atlas is stable under dependent sums.

\begin{theorem}{\label{thm:atlasStableSum}}
	Let $\bT$ be a topology.
	Let $\cU'$ be a class stable under dependent sums containing $\Zar$.
	The class of types merely admitting a $\cU'$-atlas is closed under dependent sums. The same holds for $\cU'$-catlasses.
\end{theorem}
\begin{proof}
%	The stability under quotients is easy: 
%	Let us construct some atlas $\Spec A \to \sum_{x : X} B_x$ %fibered in smooth $n$-stacks.
	For any $x : X$ we merely have an atlas $V_x \to B_x$, i.e. with $V_x$ affine. %fibered in smooth $n$-stacks . \\
	$X$ has $\bT$-local choice wrt atlasses by (\ref{prop:LocalChoice}) using $\cU'$ is $\sum$-stable (we use the trivial topology).\\
	If additionally, all the $B_x$ and $X$ are smooth $n$-stacks, just observe that we can choose the affine $V_{p u}$ to lie in $\bT$, Accordingly $\sum_{u : U} V_{p u} \in T$ as $\bT$ is stable under $\Sigma$.

%	$n$-atlasses contain zariski-atlasses, because $\bT$ is finer than the Zariski topology.
%	$\cU' are stable under dependent sum by induction, thus $n$-atlasses are stable under composition.         
%	\qed(Claim)\\
	By Local choice for $X$, we merely find $U$ affine, an atlas $p : U \to X$ % fibered in smooth $n$-stacks 
	with
	\[
	\prod_{u : U} \sum_{V_{p(u)} \in T} (q : V_{p(u)} \to B_{p(u)}) \times (q \ \text{fibered in } \cU'  )
	\]
	Now the desired map is $\sum_{u : U} V_{p u} \to \sum_{x : X} B_x$, because it is  an atlas %fibered in smooth $(n)$-stacks 
	by \ref{lemma:AtlasSum} \\
\end{proof}
%\begin{prop}{\label{prop:atlasStableCover}}
%	Let $\cU'$ be a class stable under dependent sums.
%	The class of types admitting a $\cU'$-(c)atlas is closed under $\cU'$-covers: If $X \to Y$ is a $\cU'$-cover, then $X$ admits a $\cU'$-(c)atlas iff $Y$ admits a $\cU'$-(c)atlas.
%\end{prop}
%\begin{proof}
%One direction is the stability under dependent sums. For the other, if $S \to X$ is a $\cU'$-atlas, then $S \to X \to Y$ is a $\cU'$-atlas by $\sum$-stability of $\cU'$.
%\end{proof}
%
\begin{corollary}{\label{cor:DescentCatlas}}
	The class of stacks merely admitting a $\bT$-catlas has descent.
\end{corollary}
\begin{proof}
	The class is stable under $\sum$ and contains $\bT$.
	If $X \to Y$ is a $\bT$-cover and $X$ admits a $\bT$-catlas then $Y$ admits a $\bT$-catlas. %This follows from \ref{prop:atlasStableCover}.
\end{proof}