\section{Geometric Propositions}
\subsection{Geometric propositions}
\begin{definition}
	An affine Scheme $U$ is called geometric, if 
	\[\|U\|_\bT \to (U \in \bT)\]	
\end{definition}
\begin{lemma}{\label{lemma:geometricEquiv}}
	The converse holds always
\end{lemma}
\begin{proof}
	because things in $\bT$ are automatically $\bT$-merely inhabited
\end{proof}
Recall the definition of $\bT$-atlas \ref{def:TAtlas}
\begin{definition}{\label{def:algprop}}
	We call a modal proposition geometric, if one of the equivalent conditions is satisfied:
	\begin{enumerate}
		\item  its merely of the form $\|U\|_\bT$ for some geometric affine $U$.
		\item There is a $\bT$-surjective map out of a geometric affine $U$.
		\item It has a $\bT$-atlas.
	\end{enumerate}
	
\end{definition}
\begin{proof} \
	\begin{enumerate}
		\item [1 $\Leftrightarrow$ 2]
		Clear.
		\item [1 $\Rightarrow$ 3]
		we show that $U \to \|U\|_\bT$ is a $\bT$-atlas. Every fiber is in $\bT$, because $U$ is geometric.
		\item [3 $\Rightarrow$ 1]
		
		Let $V \to P$ be a $\bT$-atlas.
		have to show TFAE $\|V\|_\bT \to P \to (V \in \bT) \overset{\ref{lemma:geometricEquiv}}{\to} \|V\|_\bT$. 
		Proof: $\|V\|_\bT \to P$ as $P$ is modal prop. Secondly, because $V \to P$ is a $\bT$-cover. \\
		Hence $P$ is a geometric proposition.	
	\end{enumerate}
	
\end{proof}

%\begin{lemma}[NECESSARY?]
%	geometric propositions are algebraic spaces.
%\end{lemma}
%\begin{proof}
%	We have $U \to \|U\|_\bT$ where $U$ is affine, hence an algebraic space and the fibers are in $\bT$ by geometricness of $U$, hence they are covering algebraic spaces. By stability under quotients, our geometric proposition is an algebraic space.
%\end{proof}
\section{Algebraic Space}
Recall the notion of (covering) 0-stacks. it is the smallest pair of classes that satisfies the following
\begin{itemize}
%	\item Stability under $\sum$ \ref{thm:stabSums} 
	\item (covering) affines are (covering) algebraic spaces. %If $\bT \ni \Spec A \to X$ is a $\bT$-cover and $X$ is a $\bT \Set$, then $X$ is a covering algebraic space
	\item stable under covering quotients: If $X$ is an algebraic space, $Y$ modal 0-type and $X \to Y$ is fibered in covering algebraic spaces, then $Y$ is an algebraic space. Additionally, if $X$ is covering, then $Y$ is covering.
\end{itemize}
\section{Fundamental Theorem of algebraic spaces}
%\subsection{For groupoids}
%\begin{lemma}
%	If $R \twoheadrightarrow X \to X$ is a $\bT$-htpy-coequalizer diagram of two $\bT$-covers between affines, then $X$ is a  1-stack.
%\end{lemma}

%\subsection{For sets}
\begin{lemma}{\label{quotient-by-equivalence-relation}}
	Denote $\bT Set$ for the sets that are $\bT$-sheaves. Assume given a $\bT$set  $X$ then the following maps are mutually inverse
	\begin{align*}
		\sum_{R:X\to X\to \bT\Prop} R\ \mathrm{equivalence\ relation} &\simeq \sum_{Y:\bT \mathrm{\Set}} \sum_{p:X\to Y} p\ \bT\mathrm{surjective} \\
		R &\mapsto (L_\bT \| X//R \|_0,[\_]) \\
		\lambda x,y.  (p(x)=p(y)) &\mapsfrom (Y,p) 
	\end{align*}
	%where $X / R$ is defined by applying $L_T \| \_ \|_0 $ at the higher inductive type $X // R$.
\end{lemma}

\begin{proof}
	\begin{itemize}
		\item Well-definedness: The map $[\_] : X \to \|X // R\|_0 \to L_T \|X // R\|_0$ is the composition of a surjective with a $\bT$-surjective map \todocite, hence its $\bT$-surjective. \\
		Conversely given $(Y,p)$ as $Y$ is a sheaf, we have for all $x,y : X$ that $p(x) =_Y p(y)$ is a sheaf.
		\item If $x,y : X$ then we have a chain of equivalences 
		\[
		R(x,y) \simeq (\bar x =_{\|X//R\|_0} \bar y) \overset{\mathsf{ap}_\eta}{\to} ([x] =_{L_T\|X//R\|_0} [y])
		\]
		where the first map is plain HoTT, meaning that $\|X//R\|_0$ is seperated. The second map is an equivalence by \ref{lemma:sep}. %, i.e. the unit of the modality \ref{lemma:idTypesOfSheafification}, but as the $\bar x =_{\|X//R\|_0} \bar y$ is already a sheaf, it is an isomorphism as well. \\
		\item Let $(Y,p)$ be in the RHS. Let $R(x,y) = (p(x)=p(y)) : \bT \Prop$. By plain HoTT, There is a map $\eta :  X // R  \to Y$ ( defined by the universal property of the set truncation and by induction on the higher inductive type $ X // R$ on canonical terms through the map $p : X \to Y$). I claim $\eta$ exhibits $Y$ as the localization for $\bT \Set$-modality of $X // R$. Let $T$ be another $\bT \Set$ equipped with a map $X // R  \to T$. By precomposition we obtain a map $X \to T$. 
		Claim: it factors uniquely through $p : X \to Y$. 
		% https://q.uiver.app/#q=WzAsNCxbMCwwLCJYIl0sWzEsMCwiXFx8WCAvIFJcXHwiXSxbMiwwLCJUIl0sWzEsMSwiWSJdLFswLDFdLFsxLDJdLFswLDNdLFszLDIsIlxcZXhpc3RzISIsMix7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dXQ==
		\[\begin{tikzcd}
			X & {X // R} & T \\
			& Y
			\arrow[from=1-1, to=1-2]
			\arrow[from=1-1, to=2-2]
			\arrow[from=1-2, to=1-3]
			\arrow["{\exists!}"', dashed, from=2-2, to=1-3]
		\end{tikzcd}\]
		Proof: \\
		Existence: We want to define a map $Y \to T$. Let $y : Y$. As $p$ is $\bT$-surjective and $T$ is a sheaf, we may assume we merely have some element in the fiber of $p$ over $y$. Now push this element through     
		\[\|\fib_p y\| \to \|X // R\|_0 \to T\]
		where the first map is by Plain HoTT and the second one is induced from $X // R \to T$ by assumption and the fact that $T$ is a set.. One can easily check this makes the diagram commute.
		Uniqueness follows from $X \to Y$ beeing $\bT$-surjective and the following
		Fact: Two parellel maps $Y \rightrightarrows T$ into a $\bT \Set$ $T$ are already equal if the become equal after precomposition with a $\bT$-surjection $X \to Y$.  \\
		Proof of the fact : Let $y : Y$. The goal is an identity type of a $\bT \Set$, hence a $\bT \Prop$. Hence As the fiber over $y$ in $X$ is $\bT$-merely inhabited, we may assume an actual term in the fiber. 	As $X \to Y$ equalizes the arrows, this term allows us to conclude. \qed (fact)	\qed(Claim) \\
		We apply the fact to the ($\bT$-)surjectivity of $X \to X // R $ to get a unique factorization 
		% https://q.uiver.app/#q=WzAsNCxbMCwwLCJYIl0sWzEsMCwiXFx8WCAvIFJcXHwiXSxbMiwwLCJUIl0sWzEsMSwiWSJdLFswLDEsIiIsMCx7InN0eWxlIjp7ImhlYWQiOnsibmFtZSI6ImVwaSJ9fX1dLFsxLDJdLFswLDNdLFszLDIsIlxcZXhpc3RzISIsMix7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFsxLDNdXQ==
		\[\begin{tikzcd}
			X & {X // R} & T \\
			& Y
			\arrow[two heads, from=1-1, to=1-2]
			\arrow[from=1-1, to=2-2]
			\arrow[from=1-2, to=1-3]
			\arrow[from=1-2, to=2-2]
			\arrow["{\exists!}"', dashed, from=2-2, to=1-3]
		\end{tikzcd}\]
		making the right triangle commute. This is what we wanted to show.
	\end{itemize}
\end{proof}

\begin{definition}
	A modal equivalence relation $R$ on a type $X$ is called covering, if for any $y:X$ the fibers
	\[R_y :\equiv \sum_{x:X} R(x,y)\]
	merely admits a $\bT$-catlas.
	
\end{definition}

\begin{lemma}{\label{lemma:fundamental-property-algebraic-spaces}}
	%Assume that $\bT$ satisfies descent for propositions and for sets 
	Assume that the topology has descent.
	Given a $\bT$set $X$, the following types are equivalent:
	\begin{itemize}
		\item The type of covering equivalence relations on $X$.
		\item The type of $\bT$sets $Y$ equipped with a map $X \to Y$ fibered in types admitting a $\bT$-catlas.
	\end{itemize}
\end{lemma}

\begin{proof}
	By the equivalence in \ref{quotient-by-equivalence-relation} it is enough to check that
	%	\begin{itemize}
	%		\item The identity types in $X/R$ are 
	%		(-1)-stacks if and only if the relation $R$ is redundant . For any $x,y:X$ we know that:
	%		\[R(x,y) \simeq [x] =_{X/R}[y]\]
	%		so the direct direction is immediate. For the converse we use the assumption that a modal proposition being a  (-1)-stack is a sheaf and that the map $[\_]:X\to X/R$ is $\bT$-surjective.
	%\item 
	The fibers of: 
	\[[\_]:X\to L_\bT \| X//R \|_0\] 
	merely admit a $\bT$-catlas if and only if the relation $R$ is covering. For any $y:X$ we have that:
	\[\sum_{x:X} R(x,y) \simeq \mathrm{fib}_{[\_]}([y])\]
	so the direct direction is immediate. The converse follows from $\bT$-surjectivity of $[\_]$ and from \ref{cor:DescentCatlas}.
	%	\end{itemize}
\end{proof}

\subsection{Algebraic spaces}

\begin{lemma}{\label{def:coveringEqRel}}
		%A modal equivalence relation $R : U^2 \to \bT \Prop$ on a set $U$ is covering if the fibers $R_s \equiv \sum_{t: S} R s t$  are covering 0-stacks.
		Consider a modal equivalence relation $R : S^2 \to \bT \Prop$ on an affine $S$. TFAE
		\begin{itemize}
			\item $R$ is covering, i.e. every fiber $R_s \equiv \sum_{t: S} R s t$ admits a $\bT$-catlas.
			\item  every fiber $R_s \equiv \sum_{t: S} R s t$ is a covering 0-stack.
\end{itemize}
\end{lemma}
\begin{proof}
Every type admitting a $\bT$-catlas is a covering 0-stack. 
Conversely: if the fibers are covering 0-stacks. Let us first observe, that for all $s , t : S$, $R s t$ is a geometric proposition: $R s t$ is the fiber of the projection $\sum_{t : S} R s t \to S$ between geometric stacks, which are stable under finite limits. \\

For all $t : S$ we can choose a geometric atlas $\Spec A_t \to R s t$ by \ref{def:algprop}. Then 
\[
\sum_{t:S} \Spec A_t \to \sum_{t : S} R s t
\]
is a $\bT$-atlas. As $\sum_{t : S} R s t$ is a covering 0-stack by assumption, the map has to be a $\bT$-catlas by \ref{lemma:atlasIsCatlas}. 
\end{proof}
%Let us also mention what we learned in the proof:
%\begin{lemma}[NECESSARY?@Â²]
%	A covering equivalence relation $R : S^2 \to \bT \Prop$ has values in geometric propositions.
%\end{lemma}

%\begin{corollary}
%	The identity types of algebraic spaces are geometric propositions.
%\end{corollary}
%\begin{proof}
%	By the previous lemma and \ref{lemma:geometricStacksClosedUnderId}
%\end{proof}
%
%\begin{lemma}{\label{lemma:detectGeomProp}}
%	Let $P$ be a sheaf and a proposition that admits a map $\Spec A \to P$ fibered in covering algebraic spaces. Then $P$ is a geometric proposition.
%\end{lemma}
%\begin{proof}
%	The fibers are covering algebraic spaces and affine, hence covering affine. By \ref{def:algprop} we conclude.
%\end{proof}
\begin{theorem}
	Let $X$ be a modal set. The following are equivalent:
	\begin{enumerate}
		\item $X$ is a (covering) geometric 0-stack
		\item $X$ is merely of the form $L_\bT (U / R)$ for some (covering) affine $U$ and  $R : U^2 \to \Prop$ a covering equivalence relation. 
		\item there exists some map $S \to X$ with $S$ (covering) affine whose fibers merely have $\bT$-catlasses.
	\end{enumerate}
	We call this class (covering) algebraic spaces.
\end{theorem}
\begin{proof}
\ 	\begin{enumerate}
	\item [2 $\leftrightarrow$ 3]
		\ref {lemma:fundamental-property-algebraic-spaces}
	\item [2 $\to$ 1]
	Choose a presentation $ R: U^2 \to \Prop$.
	It suffices to show, that the map $f : U \to L_\bT ( U / R)$ is a geometric (c)atlas. The map $f$ is $\bT$-surjective by the well-definedness of the bijection $\ref{quotient-by-equivalence-relation}$. By descent we may just show, that the fibers $\fib_f (f(s))$ for $s : U$ are covering 0-stacks. But by the bijection in \ref{quotient-by-equivalence-relation} those are equivalent to the fibers $R_s$, which are covering 0-stacks as the equivalence relation is covering. \\
	\item [1 $\to$ 2]
	This can be reformulated in the following way, using the recursion principle for (covering) geometric 0-stacks:
	Let $X$ be a sheaf of sets. Let $S$ be (covering-) affine and $f : S \to X$ be fibered in covering algebraic spaces. Then $X$ is a (covering) algebraic space.
%	The identity types of $X$ admit a map fibered in covering algebraic spaces (todo check stability under $\sum$) out of an affine by \ref{lemma:havingAbstractAtlasClosedUnderId}. by \ref{lemma:detectGeomProp} they are geometric propositions. 
This follows from the observation, that the equivalence relation determined by $f$ is covering \ref{def:coveringEqRel} , because the fibers of $f$ are covering 0-stacks.
	\end{enumerate}
\end{proof}
\subsection{Schemes are algebraic Spaces for the Zariski Topology}
\begin{definition}
 A proposition $U$ is open iff its merely of the form $f_1 \ inv \lor \hdots f_n inv$ for some $f_i : R$.
\end{definition}
\begin{definition}
	A Zariski sheaf $X$ is a scheme if there merely exists some affine $S$  map $S \to X$ whose fibers are Zariski-merely inhabited finite sums of open propositions 
\end{definition}
\begin{lemma}
	Given $f_1, \hdots,f_n : R$ such that $\| D(f_1) + \hdots + D(f_n) \|_{\Zar}$ then $\sum_{i=1}^n D(f_i) \in \Zar$.
\end{lemma}
\begin{proof}
	We have to show that $(f_1,\hdots,f_n) = 1$. 
	Claim: 	$(f_1,\hdots,f_n) = 1$ is a sheaf.
	Proof: 
	Recall that the Zariski topology is subcanonical (\todocite). Now the type is equivalent to the statement that the map between the two sheaves $\Spec 0 \to \Spec R/(f_1,\hdots,f_n)$ is an equivalence. This is a sheaf \todocite.
\end{proof}
\begin{prop}
	Every Zariski-merely-inhabited type that is merely of the form $U_1 + \hdots + U_n$ for open propositions $U_i$ admits a $\Zar$-catlas.
\end{prop}
\begin{proof}
	By definition of openness, We can choose a surjection $\coprod_{j=1}^{n_i} D(f_{ij}) \twoheadrightarrow U_i$ for any $i$. We want to show, that the map
	\[
	\coprod_{i , j} D(f_{ij}) \twoheadrightarrow U_1 + \hdots U_n
	\]
	is a $\Zar$-catlas. 
	\begin{itemize}
		\item Let us first show that the fibers are in $\Zar$. Assume $U_i$ holds. So we find a term in $\coprod_j D(f_{ij})$. In particular we have $\| \coprod_j D(f_{ij})\|_{\Zar}$. By the lemma we conclude, that the fiber $\sum_j D(f_{ij})$ belongs to $\Zar$.\\
		\item The total space is in $\Zar$: This follows as the surjection after $\bT$-truncation becomes an equivalence. As we have $\| U_1 + \hdots + U_n\|_\bT$, we can conclude by the lemma.
	\end{itemize}
	
\end{proof}
\begin{warning}
	The converse does not hold! Apply \ref{lemma:sheafificationHasTCover} to the map
	\[\Zar \ni 1 + 1 \to \sum D(f) \]
	$\sum D(f)$ is seperated as $D(f)$ is a sheaf.
	All the fibers are equivalent to $1 + X$, hence they are in the Zariski topology.
	Use that beeing in the Zariski topology has Zariski-descent.	
\end{warning}
\begin{corollary}
		Every scheme is an algebraic space for the Zariski topology.
\end{corollary}
\begin{question}
	Is every algebraic space for the zariski topology a scheme?
\end{question}
\begin{lemma}
	Every $\Zar$-sheaf that admits a $\Zar$-atlas is a scheme. Hence, every geometric proposition is a scheme
\end{lemma}
\begin{proof}
	Obvious.
\end{proof}
%
%\subsection{Stability under covers TODO}
%In this subsection we want to prove the following:
%\begin{theorem}[TODO]
%	The class of covering $\cV$-stacks is the smallest intermediate class $\bT \subset \tilde T \subset \cV$ such that whenever $X \in \tilde \bT, Y \in \cV$ and $X \to Y$ is fibered in $\tilde \bT$, then $Y \in \tilde \bT$.
%\end{theorem}
%
%\begin{lemma}
%	Covering stacks are stable by dependent sums: If $X \in \CS_\cV$, $Y : X \to \CS_\cV$, then $\sum_{x: X} Y x \in CS$.
%\end{lemma}
%\begin{proof}
%	Lets first prove the special case where $X \in \bT$. By choice of $X$ we can choose a $C$-atlas $Q x \to Y x$ for every $x$. Now $\sum_{x : X} Q x \to \sum_{x: X} Y x$ is fibered in $C$ by \ref{lemma:AtlasSum} and the domain is in $\bT$ by $\sum$-stability of $\bT$. \\
%	For the general case, choose a $C$-atlas $p : T \to X$ with $T \in \bT$. Then we have a map
%	\[
%	\sum_{t : T} Y (p t) \to \sum_{x : X} Y x
%	\]
%	where every fiber is equivalent to a fiber of $p$, i.e. its a covering $C$-stack. As its domain is a covering $C$-stack by the previous case, we can choose an atlas .
%\end{proof}
%\begin{proof}
%	The first class is definitely contained in the second class. To show that they coincide we need to show, that the first class is stable under $\sum$ and under quotients. For the first point we use choice of affines. The second point 
%\end{proof}
%
%
%The first point is the minimal definition which is good mapping out of the class of coverings stacks and the second one is useful to keep in mind the stability results.
%The closedness under covers assumption is the conjunction of closed under $\sum$ (as $C$ $\sum$-stable) and closed under quotients. \\
%\begin{lemma}
%	covering $C$-stacks contain $1$ and are closed under $\sum$.
%\end{lemma}
%
%
%THIS IS UNUSUAL, but surprisingly useful.
%Let $n \ge 0$.
%%\begin{lemma}[TODO]
%%	If $D \subset C$, then the cover-closure of (covering $C$-stacks $\cap D$) inside $D$ are  covering $D$-stacks. 
%%\end{lemma}
%\begin{example}
%	Affine covering $0$-stacks are the saturation of $\bT$.
%\end{example}
%%\begin{corollary}[Indepedence of the truncation level]
%%	(covering) $n+1$-type-stacks that are $n$-types $=$ (covering) $n$-type stacks.
%%\end{corollary}
%%\begin{proof}
%%	Only need to show $\subset$. First the covering part. For this just show the LHS is closed under covers between $n$-types by the previos lemma. \\
%%	For the non covering part, let $\Spec A \to X$ be fibered in covering $n+1$-type-stacks where $X$ is a $n$-type. Then the fibers are $n$-types, hence by the covering case, they are covering $n$-type stacks.
%%\end{proof}
%\begin{definition}
%	$X$ is a (covering) 0-stack, if its a (covering) 0-type-stack.
%\end{definition}
%\begin{theorem}[TODO]
%	Let $X$ be a type. TFAE for all $n$ :
%	\begin{enumerate}
%		\item $X$ is a covering $n$-type-stack.
%		
%		\item Inductively, There merely exists some $U \in \bT$ with a map $U \to X$ fibered in covering $n-1$-stacks.
%		\item[2'] Inductively, as the previous one but additionally the $\id$-types of $X$ are $n-1$-stacks.
%		\item Inductively, There merely exists some covering $n-1$-stack $U$ with a map $U \to X$ fibered in covering $n-1$-stacks.		
%		\item[3'] Inductively, as the previous one but additionally the $\id$-types of $X$ are $n-1$-stacks.
%	\end{enumerate}
%	If one of the conditions is satisfied we call $X$ a covering $n$-stack.
%\end{theorem}
%\begin{proof}
%	Induction $n-1 \mapsto n$ , $n \ge 1$.
%	\begin{enumerate}
%		\item[1. $\Rightarrow$ 2] We have to show, that the class in 2. is closed under $\sum$ and closed under quotients between $n$-types. This was already done.
%		\item [2. $\Rightarrow$ 3] Clear
%		\item [3. $\Rightarrow$ 3'] By  \ref{lemma:geometricStacksClosedUnderId} and independence of the truncation level (TODO).
%		\item [3'. $\Rightarrow$ 3 , 2' $\Rightarrow$ 2] Clear
%		
%		\item [3'. $\Rightarrow$ 1.]  by induction, covering $n-1$-stacks $=$ covering $n-1$-type-stacks $\subset$ covering $n$-type-stacks. Now use stability under covers between $n$-types.
%		\item [3' $\Rightarrow$ 2'] Use 3 $\Rightarrow 1 \Rightarrow 2$.
%		%	\item [2. $\Rightarrow$ 3] By some argument of Hugo, an $X$ as in $2.$ is an $n$-type.
%	\end{enumerate}
%\end{proof}
%%We want: = covering $n$-stacks. The $\subset$-direction is clear, as covering $n$-stacks should be stable under covers between $n$-types. for $\supset$, make sure that covering $n$-stacks for $n$ small can be constructed as a quotient by a $\bT$-cover