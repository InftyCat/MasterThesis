\documentclass{article}
\newcommand{\Cov}{\emph{Cov} }
\newcommand{\affineA}{(affine ?)}
\newcommand{\Cover}{\emph{Cov}er }
\newcommand{\truncation}{$\bT$runcation}
%\newcommand{\Atl}{\emph{Atlas}}
\usepackage{graphicx} % Required for inserting images
\newcommand{\red}[1]{{\color{red} #1}}
\newcommand{\St}{\mathsf{St}}
\newcommand{\CS}{\mathsf{CS}}
\newcommand{\Zar}{\mathsf{Zar}}
\newcommand{\refl}{\mathsf{refl}}
\newcommand{\ap}{\mathsf{ap}}
\newcommand{\Aff}{\mathsf{Aff}}
\newcommand{\Sep}{\mathsf{Sep}}
\include{preamble}

\renewcommand{\GS}{\mathsf{GS}}
\title{Thesis}
\author{Tim Lichtnau }
\date{May 2024}

\begin{document}
\newtheorem*{warning}{Warning}
\newtheorem*{why}{Why I did it this way}
\newtheorem*{think}{Think about}
\maketitle
\include{Atlas}

\section{Preparation}


\begin{lemma}{\label{lemma:havingAbstractAtlasClosedUnderId}}
	Let $C$ be a class of types stable under $\sum$. %HOPE WE DONT NEED (because we want to apply it to \cV = covering stacks) finite limits, i.e. containing 1, stable under dependent sums and finite limits
	The class $\mathsf{HasAtlas}_C$ of types $Y$ which admit a map $\Aff \ni S \to Y$ fibered in $C$ is stable under identity types. %.  If it contains $C$ and is closed under dependent sums, then it is closed under taking identity types.
\end{lemma}
\begin{proof}
%	Obviously 1 has an atlas, and the class of types admitting an atlas is stable by $\sum$ by \ref{thm:atlasStableSum}.
%	It remains to show, that identity types in $Y$ have an atlas provided that $Y$ has an atlas.
	
	%This is a special case of stability under dependent sums. But lets prove it anyway.
	By assumption we can choose a map $\Aff \ni V \overset{p}{\to} Y$ fibered in $C$. Let $y,y' : Y$.  Then we have the map
	\begin{align*}
		(\fib_p y) \times_V (\fib_p y') &\to y = y' \\
		(v , q : y = p v) , (v', q' : y' = p v') , (h : v = v') &\mapsto q \cdot h \cdot q'^{-1}
	\end{align*}
	
	The fiber over $j : y = y'$ looks like  %because $y$ and $y'$ are free we may only show the statement for the fiber over the path  $\mathsf{refl}_y : y = y$. 
	\[
	\sum_{v}  ( \underbrace{\sum_{v'} (h : v = v')}_{\mathsf{isContr}}) \times (q : y = p v) \times (q'  : y' = p v') \times (q \cdot h \cdot q'^{-1} = j) \simeq \sum_v (v = py) \simeq \fib_p y
	\]
	Hence the map is fibered in $C$. It suffices to show, that	$(\fib_p y) \times_V (\fib_p y')$ has an atlas, because then we can compose such an atlas with the above map to obtain an atlas of $y = y'$.
	By assumption the fibers of $p$ have an atlas, so we can choose $q : W \to \fib_p y, q' : W' \to \fib_p y'$ atlasses. Then $W \times_V W' \to (\fib_p y) \times_V (\fib_p y')$ is an atlas: The domain is a fiber product of types in $\Aff$, hence it belongs to $\Aff$. The fiber over $(x,x')$ is equivalent to the product of fibers $(\fib_q x) \times (\fib_{q'} x')$ which is in $C$ by stability under dependent sums (so in particular under finite products).
	
\end{proof}
\begin{lemma}{\label{lemma:AtlasSum}}
	Let $\cU' \subset \cU$ be stable under dependent sums.
	Let $X$ be a type with a  map $p : U \to X$ fibered in $\cU'$.  For any $x : X$, let $Y_x$ be a type and moreover for any $u : U$, we are given a map $q_u : V_u \to Y_{p(u)}$ fibered in $\cU'$. Then the induced map
	\[
	p : \sum_{u : U} V_u \to \sum_{x : X} Y_{x}
	\]
	is fibered in $\cU'$
\end{lemma}
\begin{proof}
	The fiber of $p$ over some $(x,y) \in \sum_{x :X} Y_x$ is given by
	\[
	\sum_{u : \fib_p x} \fib_{q_u} (y') 
	\]
	where $y' : Y_{p(u)}$ (depending on $u$) is the transport of $y : Y_x$ along $x = p(u)$. As $\cU'$ is stable under dependent sum %(\ref{lemma:LexSumStable}, \ref{lemma:LexStability}), 
	those fibers are again in $\cU'$. This shows the result.
\end{proof}
\include{LexModalities}
\include{LocalChoice}
\include{Stacks}
\include{Descent}
\include{SaturatedTopology}
\include{LocalProperties}
\include{Flat}
\include{GeomPropositions}
\include{FundamentalThmAlgSpc}
\include{AlgebraicSpace}




\section{Deloopings and Truncations}

We denote $\| \cdot \|_n^\bT := L_\bT \| \cdot \|_n$, which is a modality. We denote 
\[
\eta_n^\bT X : X \to \| X\|_n^\bT
\]
\begin{definition}
	A pointed stack $(X,x)$ is called $\bT$-connected if for any $y : X$ we have $\|x = y\|_\bT$.
\end{definition}
\begin{definition}
	Let $G$ be a stack. A delooping stack of $G$ is a  pointed $\bT$-connected stack $B G$ equipped with an equivalence $\Omega B G \simeq G$.
\end{definition}

\begin{lemma}{\label{lemma:deloopingCS}}
	Let $G$ be a covering stack, that admits a delooping stack $B G$. Then $B G$ is a covering stack.
\end{lemma}
\begin{proof}
	Now assume $G$ is a covering stack. 	To show, that  $B G$ is a covering stack, we may show that the map $\bT \ni 1 \to B G$ is a geometric atlas. As $B G$ is $\bT$-connected, every point is $\bT$-merely equal to the basepoint. By descent for covering stacks, we may just show that the fiber over the basepoint is a covering stack
	But this is equivalent to $\Omega B G \simeq G$. 
\end{proof}
\begin{corollary}
	If $G$ is a covering group 0-stack,  that admits an $n$-fold delooping stack $B^n G$, then this will be a covering $n$-stack.
\end{corollary}
\begin{lemma}
	The fiber of $\eta_n^\bT X : X \to \|X\|_n^\bT$ over $|x|$ is $\sum_{y : X} \| x = y\|_{(n-1)\bT}$
\end{lemma}
\begin{proof}
	For any $x : X$, we may show that the type family
	\begin{align*}
		B : \|X\|_n^\bT &\to \cU_{n-1}^\bT \\
		\|y\|_n &\mapsto \| x = y \|_{n-1}^\bT
	\end{align*}
	defined using the $n$ truncatedness of the stack $\cU_{n-1,\bT}$, is a unary identity system of $\|X\|_{n}^\bT$ at $|x|$. 
	By the fundamental system of identity types its enough to construct for all $y : \| X\|_n^\bT$, a section of the map $|x| = y \to B y$ induced by path induction. \\
	As the space of sections of a map between $n$-stacks is in particular an $n$-stack, we may just for all $y : X$ construct a section of the map 
	\[\mathrm{ind} : |x| =_{\|X\|_n^\bT} |y| \to \| x = y \|_{n-1}^\bT\]
	But $|x| = |y|$ is an $n-1$-stack, so there is a unique dashed map $\sigma$ such that the above triangle
% https://q.uiver.app/#q=WzAsNCxbMCwxLCJ8eHw9fHl8Il0sWzEsMSwiXFx8eCA9X1ggeSBcXHxfe259XlxcYlQiXSxbMSwwLCJ4ID1fWCB5Il0sWzEsMiwiXFx8eCA9X1ggeSBcXHxfe259XlxcYlQiXSxbMiwxLCJcXGV0YSJdLFsyLDAsIlxcYXAiLDJdLFsxLDAsIlxcc2lnbWEiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMSwzLCJcXGlkIl0sWzAsMywiXFxtYXRocm17aW5kfSIsMix7ImN1cnZlIjoyfV1d
\[\begin{tikzcd}
	& {x =_X y} \\
	{|x|=|y|} & {\|x =_X y \|_{n}^\bT} \\
	& {\|x =_X y \|_{n}^\bT}
	\arrow["\ap"', from=1-2, to=2-1]
	\arrow["\eta", from=1-2, to=2-2]
	\arrow["{\mathrm{ind}}"', curve={height=12pt}, from=2-1, to=3-2]
	\arrow["\exists! \sigma", dashed, from=2-2, to=2-1]
	\arrow["\id", from=2-2, to=3-2]
\end{tikzcd}\]
	commutes. This is indeed a section of the above map, because the maps $\mathrm{ind} \circ \sigma$ and $\id$ targeting an $n$-stack become equal after postcomposition with the unit $\eta$ of the modality $L_\bT \| \cdot \|_n$.
	
%	
%	
%	We may show, that the map
%	
%		For this we need that for all $x ,y : X$ the map
%	\[
%	\|x =_X y \|_{n-1,\bT} \to |x| =_{\|X\|_{n\bT}} |y|
%	\]
%	is an equivalence. 
 	
%	\[
%	\isContr \sum_{y : \|X\|_n^\bT} B y \simeq \prod_{y : \|X\|_n^\bT} \prod_{t : By}(p : |x| = y) \times (\tp_p r = t)
%	\]
%	where $r : B |x|$ is defined as $| \refl_x|$. \\
%	So Let $x : X$. For any such $y$ the type $\prod_{t : By}(p : |x| =_{\|X\|_n^\bT} y) \times (\tp_p r = t)$ is an $n$-stack so we may just provide a term in
%	\[
%	\prod_{y : X} \prod_{t : \| x = y\|_{n-1,\bT}}(p : |x| =_{\|X\|_n^\bT} |y|) \times (\tp_p r = t)	
%	\]
%	Let $y : X$. For any such $t$, as $(p : |x| =_{\|X\|_n^\bT} |y|) \times (|p| = t)$ is a $n-1$-stack, we may just construct a term in
%	\[
%	\prod_{t : x = y} (p : |x| = |y|) \times \tp_p r = |t|
%	\]
%	this is obvious by setting $p := \mathsf{ap}_{|\_|} t$ and we compute
%	\[
%	\tp_{\ap_{|\_|} t} |\refl_x| = | t \cdot \refl_x | = |t|
%	\]
\end{proof}
\begin{lemma}
	For any $X$ and any $n \ge -1$, the map $\eta_n^\bT X : X \to \|X\|_n^\bT$ is $\bT$-surjective.
\end{lemma}
\begin{proof}
	It factors as $X \to \|X\|_n \to L_\bT \|X\|_n$ where the latter map is $\bT$-surjective. So it sufficess to show, that the former map is surjective. As $X \to \|X\|_0$ is surjective it suffices to show, that $\ap$ of the map $\|X\|_n \to \|X\|_0$ is surjective. TODO %But for any type $T$ the map $T \to \|T\|_0$ is surjective.
\end{proof}
\begin{lemma}{\label{lemma:loopOfFiber}}
	If $(X,x)$ is a pointed stack, the looping of the fiber of $X \to \|X\|_{n}^\bT$ over $|x|$ is the basefiber of $\Omega X \to \|\Omega X\|_{n-1}^\bT$.
	\[
	\Omega (\fib(\eta_n^\bT X)(|x|)) \simeq \fib (\eta_{n-1}^\bT \Omega (X,x))(pt)
	\]
\end{lemma}
\begin{proof}
	We have to understand the loop space of $\sum_{y : X} \| x = y\|_{(k-1)\bT}$. It is given by
	\[(p : \Omega X) \times \left(\tp_p r =_{\|\Omega X\|_{k-1,\bT}} r  \right),\]
	where $ r= |\refl|$.
	 we calculate $\tp_p r = |p|$, so it is the fiber of 
	\[
	\Omega X  \to \|\Omega X \|_{k-1, \bT}
	\]
	over the basepoint $|\refl|$.
\end{proof}
\begin{prop}
	Let $n \ge 0$ , $X$ be a geometric stack, such that for all $x : X$, $\Omega^{n+1} (X , x)$ is a covering stack for all $x : X$. Then $\eta_n^\bT X : X \to \|X\|_n^\bT$ is a geometric cover. In particular, $\|X\|_n^\bT$ is a geometric $n$-stack.
\end{prop}
\begin{proof}
	Let us show by induction over $k = -1,\hdots,n$ that 
	\[\eta_k^\bT (\Omega^{n - k} X) : \Omega^{n - k} X \to \|\Omega^{n - k} X\|_k^\bT\]
	is a geometric cover.  \\
	$k=-1$ is okay as $\Omega^{n+1} X$ is a covering stack and $\bT$-truncations of covering stacks are contractible. \\
	For the induction step $k - 1 \mapsto k$:
	Set $X' := \Omega^{n-k} X$, so we want to show that $X' \to \|X'\|_k^\bT$ is a geometric cover.
	Every fiber is modal so the fiber beeing a covering stack has descent, so we may just show that the fiber over the image of some $x : X$ is a covering stack. The fiber $\sum_{y : X} \| x = y\|_{(k-1)\bT}$ is $\bT$-connected, so its a delooping stack of the basefiber of 
	\[
	\Omega X  \to \|\Omega X \|_{k-1, \bT}
	\]
	by \ref{lemma:loopOfFiber} and \ref{lemma:deloopingCS} we conclude.
\end{proof}


\begin{definition}
	A higher group stack is a pointed $\bT$-connected stack.
\end{definition}
Let $BG$ be a higher group stack and $X$ be a geometric stack equipped with an action $\rho : BG \to \GS$. We use the standart notation

\[
X // G :\equiv \sum_{BG} \rho
\]
\begin{lemma}
 If $G$ is covering, then $X // G$ is a geometric stack
\end{lemma}
\begin{proof}
	$BG$ is a covering stack, as $G$ is a covering stack \ref{lemma:deloopingCS}. Hence $X // G :\equiv \sum_{BG} \rho$ is a geometric stack.
\end{proof}
\begin{prop}
	%Let $BG$ be a higher group stack and $X : BG \to \GS$ be a geometric $G$-stack. 
	If $X // G$ is a geometric stack (e.g. if $G$ is covering) and the isotropy stacks $\sum_{g : G} g x = x$ are covering stacks, then $\| X // G \|_0^\bT$ is an algebraic space.
\end{prop}
\begin{proof}
	To apply the prop, we have to show, that for all $x : X // G$, $\Omega (X // G,x)$ is a covering stack. As $X \to X // G$ is $\bT$-surjective (todo details), we may just show this for $x : X$.
	\[
	\Omega (X // G , [x]) \simeq \sum_{g: G} g x = x
	\]
	which was covering by assumption
\end{proof}
\begin{corollary}
	Let $X$ be a geometric stack, whose identity types are covering stacks. Let $G$ be a finite group acting on $X$. Then $L_\bT (X / G)$ is a geometric stack.
\end{corollary}
\begin{proof}
	 The isotropy stacks are covering, as they are $\sum$ of covering stacks.
\end{proof}
We can also reprove \ref{lemma:algSpacesStabFreeQuots}: $G$ is a finite type by assumption, hence covering. The isotropy stacks are assumed to be propositions, but they are inhabited, so they are covering \qed(lemma) \\

TODO: Find a good example of a non covering $G$.

\section{Artin stacks vs Deligne Mumford}



\subsection{Weakly-flat stacks}
\begin{definition}
	We call a geometric stack $X$ weakly-flat iff one of the following conditions is satisfied
	\begin{enumerate}
		\item $\|X\|_{-1}^\bT \to X \in \CS$
		\item For any geometric atlas $W \to X$ , $W$ is weakly-flat, i.e $\|W\|^\bT \to W \in \bT$.
	\end{enumerate}

\end{definition}
\begin{proof}
	\ \begin{enumerate}
		\item [1 $\Rightarrow$ 2] Choose a geometric atlas $W \to X$. In particular its $\bT$-surjective, hence we have $\|W\|^\bT$, so by assumption $W \in \bT$. So $X \in CS$.
		\item [2 $\Rightarrow$ 1] 
		\[\|W\|^\bT \to \|X\|^\bT \to X \in \CS \overset{\ref{lemma:atlasIsCatlas}} W \in \bT \]
	\end{enumerate}
\end{proof}
%		\item 
%
\begin{lemma}
For any weakly-flat geometric stack $X$, $\|X\|_{-1}^\bT$ is a geometric stack.
\end{lemma}
\begin{proof}
	$X \to \|X\|_{-1}^\bT$ is a geometric cover.
\end{proof}
\begin{prop}{\label{prop:EtaleTruncations}}
	Assume that loopspaces of covering stacks are covering. TFAE
	\begin{enumerate}
		\item $X \to \|X\|_n^\bT$ is a geometric cover
		\item  all $n+1$-fold identity types of $X$ are weakly-flat.
	
		\item For any $x$, $\Omega^{n+1} (X , x)$ is covering.
			\item For any sequence $x_0 : X \equiv X_0$ , $x_{k+1} : (x_{k} =_{X_k} x_k) \equiv X_{k+1}$, $x_n =_{X_n} x_n$ is covering.
	\end{enumerate}

\end{prop}
\begin{proof}
	\item [3 $\Rightarrow$ 1] already done
	\item [2 $\Rightarrow$ 4] ez
	\item [1 $\Rightarrow$ 3]

	By applying iteratively \ref{lemma:loopOfFiber} 
	\begin{align*}
	\Omega^{n+1} (\fib (\eta_n^\bT X) |x|) &\simeq \Omega^n \fib (\eta_{n-1}^\bT (\Omega (X,x))) pt \simeq \hdots \\
	&\simeq \Omega^{n-k} \fib(\eta_{n-k-1}^\bT \Omega^{k+1}(X,x)) pt \simeq \hdots \\
	&\simeq \fib (\eta_{-1}^\bT \Omega^{n+1} (X,x)) pt \\
	&\simeq \Omega^{n+1} (X , x)
	\end{align*}
	If for any $x$ , the fiber of $\eta_n^\bT X$ over $|x|$ is covering, then its $n+1$-fold loop space covering by assumption, so also $\Omega^{n+1} (X , x)$.	
	\item [4 $\Rightarrow$ 2] If $I_n$ is an $n$-fold identity type. To show that $x =_{I_n} y$ is weakly-flat, by descent we may assume that $x = y$. Then we have $(x = y) \simeq (x =_{I_n} x)$. Now $x$ induces an equivalence $I_n \simeq X_n$ to a reflexive $n$-fold identity type by iterated transport. By 4. the corresponding loopspace of $X_n$ is covering.
	\item [3 $\Rightarrow$ 4] Applying $x_k \cdot \_$ from the left induces an equivalence
	\[\refl =_{X_k} \refl \to x_k =_{X_k} x_k \]
	Conclude inductively
\end{proof}
\subsection{Deligne Mumford stacks are uninteresting}
%The goal of this subsection is the following:
\begin{lemma}{\label{lemma:SetUnramfied}}
	Given morphisms of types $X \to Y \to Z$ with $X \to Z$ formally unramified and $Y$ a set, then $X \to Y$ formally unramified.
\end{lemma}
\begin{proof}
	We can argue fiberwise so we may assume $Z$ beeing the point. A fiber of $f : X \to Y$ over $y$ is $\sum_{x: X} f x = y$ where $f x = y$ is a proposition,hence formally unramified. As $X$ is formally unramified we conclude as formally unramified types are $\sum$-stable.
\end{proof}
\begin{lemma}{\label{lemma:DMUnrIdTypes}}
	Any Deligne Mumford stack $X$ has formally unramified identity types.
\end{lemma}
\begin{proof}
	 We need to show that $X \to X \times X$ is formally unramified. As formally unramified is a local property of stacks \ref{lemma:SeperationIsLocal} it suffices to show that the map $W \times_X W \to W \times W$ as a basechange along the covering $W \times W \to X \times X$ is formally unramified. But postcomposing with the first projection $W \times_X W \to W \times W \to W$ is formally unramified so by \ref{lemma:SetUnramfied} we conclude.
\end{proof}

\begin{theorem}
	For any Deligne-Mumford stack $X$, the map $X \to \|X\|_1^\bT$ is an \etale cover. In particular $\|X\|_1^\bT$ is a Deligne-Mumford stack.
\end{theorem}
\begin{proof}
	By \ref{prop:EtaleTruncations}, \ref{lemma:coveringDMstacks} we need to show that for any $x : X$, $\Omega^2(X,x)$ is formally \etale. By \ref{lemma:DMUnrIdTypes}, $x =_X x$ is formally unramified, hence its identity types are formally \etale.
\end{proof}

\begin{theorem}[TODO]
	An Artin stack $X$ is Deligne Mumford iff one of the following conditions is satisfied:
	\begin{enumerate}
		\item There exists a geometric atlas $W \to X$
		\item The identity types of $X$ are formally unramified
	\end{enumerate}
\end{theorem}
\begin{proof}
	\begin{enumerate}
		\item [1. $\Rightarrow $2.] \ref{lemma:DMUnrIdTypes}
		\item [2. $\Rightarrow$ 1] Residual gerbes??? [06MF]
		%As a stack beeing formally unramified is a sheaf and $%
	\end{enumerate}
\end{proof}
%
%\begin{lemma}
%	Given a geometric atlas $p : X_0 \to X$ of a geometric stack $X$, $\|X_0 \times_X X_0\|_0^\bT$ is an algebraic space, iff for any $x, y : X$ , $\| x =_X y \|_0^\bT$ are algebraic spaces.	
%\end{lemma}
%\begin{proof}
%	The map $p : X_0 \to X$ is $\bT$-surjective, so by descent we may just show the respective statement for $p x, p y : X$ for $x ,y : X_0$. 
%	Now we use 	that the fibers of the map
%	\[
%	\|X_0 \times_X X_0\|_0^\bT = \sum_{x y : X_0} \| x =_X y\|_0^\bT \to X_0 \times X_0 
%	\] %= \sum_{x , y} |x| =_{\|X\|_1^\bT} |y|
%	are geometric stacks iff the domain is a geometric stack.
%	
%\end{proof}
%\begin{lemma}
%	TFAE
%	\begin{enumerate}
%		\item  Any geometric atlas $X_0 \to X$ satisfies that $p_1 : \|X_0 \times_X X_0\|_0^\bT \to X_0$ is covering
%		\item $X \to \|X\|_1^\bT$ is covering
%		\item  $\Omega^2(X,x)$ is covering for all $x : X$. 
%	\end{enumerate}
%
%\end{lemma}
%\begin{proof}
%	2. and 3. are equivalent by \ref{prop:EtaleTruncations}. Choose a geometric atlas $X_0 \to X$. Then 
%	\[
%	\|X_0 \times_X X_0\|_0^\bT \simeq \| \sum_{x y : X_0} p x =_X py \|_0^\bT \simeq \sum_{x y  : X_0} \| px  =_X p y \|_0^\bT = \sum_{x y : X_0} |x| =_{\|X\|_1^\bT} |y| \simeq X_0 \times_{\|X\|_1^\bT} X_0
%	\]
%	So $\|X_0 \times_X X_0\|_0^\bT \to X_0$ is covering iff $X_0 \to \|X\|_1^\bT$ is covering iff $X \to \|X\|_1^\bT$ is covering by stability under covers.
%\end{proof}

	%	$X \to \|X\|_0^\bT$ is a geometric cover iff for all $x : X$, $\sum_{y : X} \|x = y\|^\bT$ is covering. If the identity types are weakly-flat then 
%\[
%\bT \ni 1 \simeq \sum_{y : X} x = y \to \sum_{y : X} \| y = x\|^\bT
%\]
%is a geometric catlas. \\
\end{document}

 