\documentclass{article}
\newcommand{\Cov}{\emph{Cov} }
\newcommand{\affineA}{(affine ?)}
\newcommand{\Cover}{\emph{Cov}er }
\newcommand{\truncation}{$\bT$runcation}
%\newcommand{\Atl}{\emph{Atlas}}
\usepackage{graphicx} % Required for inserting images
\newcommand{\red}[1]{{\color{red} #1}}

\include{preamble}
\title{Thesis}
\author{Tim Lichtnau }
\date{May 2024}

\begin{document}

\maketitle
\include{SaturatedTopology}
\include{LexModalities}
\include{Atlas}
\include{LocalChoice}
\include{AlgebraicSpace}
\section{ $n$-stacks}

% \begin{rmk}
% A  (-1)-stack should not be defined as an affine scheme: Because otherwise schemes $\subset$ algebraic spaces would not be  0-stacks, because in general their identity types are not affine.
% \end{rmk}
% \begin{definition}
% Let $\bT$ be a subcanonical topology finer than the Zariski topology. A type $X$ 
%     \begin{itemize}
        
    
%         \item is a  1-stack if
%         \begin{itemize}
%             \item $X$ is a $\bT$-sheaf
%             \item There exists a $\bT$-cover $\Spec A \to X$
%             \item Coinductively, identity types of $X$ are atomar stacks.
%         \end{itemize}        
        
%         \item a  $n$-stack for $-2 \le n \le 0$ iff is an $n$-type and a  1-stack
%         \item a smooth $n$-stack for $-2 \le n \le 0$ iff its  and there is a $\bT$-cover $\bT \ni \Spec A \to X$
        
%         \item is A  $(n+1)$-stack for $n \ge 1$, if 
%         \begin{itemize}
%             \item $X$ is a $\bT$-sheaf
%             \item For any $x , y : X$ $x =_X y$ is a  $n$-stack
%             \item There exists an $n$-atlas, i.e. a $\bT$-surjective map $\Spec A \to X$ fibered in smooth $n$-stacks
%         \end{itemize}
%         \item $X$ is a smooth $n+1$-stack if
%         \begin{itemize}
%             \item $X$ is a  $(n+1)$-stack
%             \item There exists a $n$-atlas $\Spec A \to X$ with $\Spec A \in \bT$
%         \end{itemize}
%     \end{itemize}
    
% \end{definition}

\begin{definition}
Let $\bT$ be a subcanonical topology finer than the Zariski topology. Let $n \ge -2$. A type $X$ 
    \begin{itemize}    
        \item is a  (smooth) -2-stack if it is contractible 
        \item is A  $(n+1)$-stack, if 
        \begin{itemize}
            \item $X$ is a $\bT$-sheaf
            \item For any $x , y : X$ $x =_X y$ is a  $n$-stack
            \item There exists an $n$-atlas, i.e. a $\bT$-surjective map $\Spec A \to X$ fibered in 
                \begin{itemize}
                    \item $\bT$, if $n \le 0$
                    \item smooth $n$-stacks, if $ n > 0$. 
                \end{itemize}
        \end{itemize}
        \item $X$ is a smooth $n+1$-stack if
        \begin{itemize}
            \item $X$ is a  $(n+1)$-stack
            \item There exists a $n$-atlas $\Spec A \to X$ with $\Spec A \in \bT$
        \end{itemize}
    \end{itemize}
    
\end{definition}
\begin{lemma}
One could only alternatively talk about  (smooth) $n$-stacks for $n \ge 1$, define them by induction as above. Then later define:
\begin{itemize}
     \item A  (smooth) -1-stack is a  (smooth) 1- stack is a proposition. \\
     \item A  (smooth) 0-stack is a  (smooth) 1-  that is a 0-type. \\    
\end{itemize}    
\end{lemma}
\begin{proof}
    %Every atomar stack is a  1-stack by \todocite. Conversely, todo
\end{proof}

% \begin{rmk}
%     \red{The red truncation plays only a role in case $n=-1 \mapsto 0 = n+1$.
%     }
%     It was invented because we want that a  1-stack that is a set is a  0-stack. For this to hold, one needs, that propositions that are  0-stacks are  -1-stacks. In \ref{lemma:prop0stacks} we will see that this is indeed the correct form.
% \end{rmk}
%In the definition of an atlas, we need a notion of surjectivity (stable under basechange) which plays well with the topology: We need if $\bT \ni \Spec A \to Y$ is such a strong surjection with $Y$ affine, then $Y \in \bT$. (*) %, then $Y \in \bT$. (*) (TODO, maybe sheaf prop?) If  allows us to 
\begin{lemma}{\label{lemma:succStab}}
    A  (smooth) $n$-stack is a  (smooth) $n+1$-stack.
\end{lemma}

\begin{proof}
    Induction. 
    We need, that $\bT$ is subcanonical to conclude that affines are $\bT$-sheaves.
\end{proof}
\begin{rmk}
    If one changes the definition of atlas to be a map out of a scheme, then smooth -1 atlas will be scheme in $\bT$. Otherwise propositional -1-stack are not 0-stacks.
\end{rmk}

\section{Stability results}
\begin{theorem}{\label{thm:stabSums}}
    Let $n \ge -2$. Smooth /  $n$-stacks are stable by dependent sums.
\end{theorem}
% \begin{notation}
%     A \emph{ cover $U \to X$ of Something} is a map $U \to X$ such that the fibers are Something.
% \end{notation}
\begin{proof}
    Induction.
    For $n = -2$ its okay.    
    Let $B : X \to \cU$ be a family of  $n+1$-stacks indexed over a  $n+1$-stack $X$, then surely the total space $\sum_{x : X} B x$ is a $\bT$-sheaf as $\bT$-sheaves are stable under depentend sum. 
    The identity types in a $\sum$ type are $\sum$ of identity types 
    \\ % and $B x$ is a fibers are  $n$-stacks by induction. \\
    It remains to construct some $n$-atlas $\Spec A \to \sum_{x : X} B_x$ %fibered in smooth $n$-stacks.
    For any $x : X$ we merely have an $n$-atlas $V_x \to B_x$, i.e. with $V_x$ affine. %fibered in smooth $n$-stacks . \\
    Claim: $X$ has local choice for $X$ wrt  $n$-atlasses.\\
    Proof:
        $n$-atlasses contain zariski-atlasses, because $\bT$ is finer than the Zariski topology.
         $n$-stacks are stable under dependent sum by induction, thus $n$-atlasses are stable under composition.         
    \qed(Claim)\\
    By (\ref{prop:LocalChoice}) for $X$, we merely find $U$ affine, an $n$-atlas $p : U \to X$ % fibered in smooth $n$-stacks 
    with
    \[
    \prod_{u : U} \sum_{V_{p(u)} \in T} (q : V_{p(u)} \to B_{p(u)}) \times (q \ \text{fibered in smooth } n \text{ stacks } )
    \]
    Now the desired map is $\sum_{u : U} V_{p u} \to \sum_{x : X} B_x$, because it is  an $n$-atlas %fibered in smooth $(n)$-stacks 
    by \ref{lemma:AtlasSum} \\
    If additionally, all the $B_x$ and $X$ are smooth $n$-stacks, just observe that we can choose the affine $V_{p u}$ to lie in $\bT$, Accordingly $\sum_{u : U} V_{p u} \in T$ as $\bT$ is stable under $\Sigma$.
    
\end{proof}
\begin{corollary}{\label{cor:atlascomp}}
    $n$-atlasses are stable under composition.
\end{corollary}
\begin{lemma}
 $n+1$-stacks are closed under taking closed (open) subtypes.
%The Class of Types which have a Zariski atlas is closed  %and closed under dependent sums.
\end{lemma}
\begin{proof}
First we show:if $X$ has an $n$-atlas and $Y$ is a closed (open) subtype of $X$, then $Y$ has an $n$-atlas. %In the presheaf model, moreover if $B : X \to \mathsf{Sch}$ is a dependent scheme such that each $B x$ has a zariski atlas, then $\sum_{x : X} Y x$ has a zariski atlas.
    Choose an $n$-atlas $\Spec A \to X$. The pullback to $Y$ has have the same fibers.
    
    If $Y$ is closed,  and the total space is a closed subtype of $\Spec A$, hence it will be affine. \\
    if $Y$ is an open subtype of $X$, then the pullback is an open subtype of $\Spec A$, hence by zariski local choice merely of the form $\bigcup_{i=1}^n D(a_i) \subset A$. 
    As $n$-atlasses are stable under composition \ref{cor:atlascomp}, it suffices to show, that the map $f : \bigsqcup_i D(a_i) \to \bigcup_{i=1}^n D(a_i)$ is a Zariski-atlas, because then it will be an $n$-atlas as well. Let $x : \bigcup_{i=1}^n D(a_i)$, i.e. there merely exists an $i$, such that $a_i(x)$ is invertible. The fiber is exactly $D(a_1(x)) + \hdots + D(a_n(x))$. thus we are done. (MAYBE OUTSOURCE THIS and say open subschemes of affines have zariski atlas)\\
    % For the $\sum$-stability: %choose 
    % First notice, that types which have a Zariski-Cover have Zariski-Local-Choice in the sense of \ref{prop:LocalChoice}: Zariski-atlasses are stable under composition. 
    % Hence using Zariski-local choice for $X$, there exists a a zariski atlas $f : \Spec A \to X$, such that
    % \[
    % \prod_{x : \Spec A} \sum_{B_x} \sum_{f_x : \Spec B_x \to Y (f x)} \mathrm{isZariskiCover}(f_x)
    % \]
    % Now $\sum_{x : \Spec A} \Spec B_x \to \sum_{x : X} Y x$ is a Zariski cover \ref{lemma:AtlasSum}, because the zariski topology is stable under dependent sums.    
    \end{proof}
\begin{corollary}
    Let $X$ be a quasi-projective scheme that is a sheaf. Then $X$ is a  0-stack. 
\end{corollary}   
\begin{proof}
    It suffices to see that $X$ has a zariski atlas. Use \label{ex:PnIsStack}.
\end{proof}


\begin{definition}
    A property of morphisms between  $n$-stacks is local, if it is satisfied by identities, stable under composition and basechange/descent along \Cov-maps, precomposition/right cancellability with \Cov-maps.
\end{definition}
\begin{lemma}
    Given a local property of types $P$. Then beeing fibered in $P$ is a local property of morphisms.
\end{lemma}
\begin{lemma}
    Given a local property $P$ of morphisms of modal $n$-types, a morphism $f : X \to Y$ has $P$ if there exists an $n$-atlas of $f$ having $P$.
\end{lemma}
The previous lemma tells us that we have the correct notion of smooth morphisms between  $n$-stacks for $n = 0,1$.
\section{Descent}
 \begin{theorem}{\label{thm:descent}}
     Let $T$ be a modal $n$-type. The Proposition, that $P$ is a  (smooth) $n$-stack, is modal.
 \end{theorem}
\section{Fundamental Theorem of algebraic spaces}
\subsection{For groupoids}
\begin{lemma}
    If $R \twoheadrightarrow X \to X$ is a $\bT$-htpy-coequalizer diagram of two $\bT$-covers between affines, then $X$ is a  1-stack.
\end{lemma}

\subsection{For sets}
\begin{lemma}\label{quotient-by-equivalence-relation}
Denote $\bT Set$ for the sets that are $\bT$-sheaves. Assume given a $\bT$set  $X$ then the following maps are mutually inverse
\begin{align*}
\sum_{R:X\to X\to \bT\Prop} R\ \mathrm{equivalence\ relation} &\simeq \sum_{Y:\bT \mathrm{\Set}} \sum_{p:X\to Y} p\ \bT\mathrm{surjective} \\
R &\mapsto (X/R,[\_]) \\
 \lambda x,y.  (p(x)=p(y)) &\mapsfrom (Y,p) 
 \end{align*}
where $X / R$ is defined by applying $L_T \| \_ \|_0 $ at the higher inductive type $X // R$.
\end{lemma}

\begin{proof}
\begin{itemize}
    \item Well-definedness: The map $[\_] : X \to \|X // R\|_0 \to L_T \|X // R\|_0$ is the composition of a surjective with a $\bT$-surjective map \todocite, hence its $\bT$-surjective. \\
    Conversely given $(Y,p)$ as $Y$ is a sheaf, we have for all $x,y : X$ that $p(x) =_Y p(y)$ is a sheaf.
    \item If $x,y : X$ then we have a chain of equivalences 
    \[
    R(x,y) \simeq (\bar x =_{\|X//R\|_0} \bar y) \to ([x] =_{L_T\|X//R\|_0} [y])
    \]
    where the first map is plain HoTT and the second map is $\mathsf{ap}$, i.e. the unit of the modality \todocite, but as the $\bar x =_{\|X//R\|_0} \bar y$ is already a sheaf, it is an isomorphism as well. \\
    \item Let $(Y,p)$ be in the RHS. Let $R(x,y) = (p(x)=p(y)) : \bT \Prop$. By plain HoTT, There is a map $\eta : \| X // R \|_0 \to Y$ ( defined by the universal property of the set truncation and by induction on the higher inductive type $ X // R$ on canonical terms through the map $p : X \to Y$). I claim $\eta$ exhibits $Y$ as the sheafification of $\|X // R\|_0$. Let $T$ be another $\bT$sheaf equipped with a map $\|X // R \|_0 \to T$. By precomposition we obtain a map $X \to T$. 
    Claim: it factors uniquely through $p : X \to Y$. 
    % https://q.uiver.app/#q=WzAsNCxbMCwwLCJYIl0sWzEsMCwiXFx8WCAvIFJcXHwiXSxbMiwwLCJUIl0sWzEsMSwiWSJdLFswLDFdLFsxLDJdLFswLDNdLFszLDIsIlxcZXhpc3RzISIsMix7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dXQ==
\[\begin{tikzcd}
	X & {\|X // R\|_0} & T \\
	& Y
	\arrow[from=1-1, to=1-2]
	\arrow[from=1-1, to=2-2]
	\arrow[from=1-2, to=1-3]
	\arrow["{\exists!}"', dashed, from=2-2, to=1-3]
\end{tikzcd}\]
Proof: \\
    Existence: We want to define a map $Y \to T$. Let $y : Y$. As $p$ is $\bT$-surjective and $T$ is a sheaf, we may assume we merely have some element in the fiber of $p$ over $y$. Now push this element through     
    \[\|\fib_p y\| \to \|X // R\|_0 \to T\]
    where the first map is by Plain HoTT and the second one was given by assumption. One can easily check this makes the diagram commute.
    Uniqueness follows as $X \to Y$ is $\bT$-surjective and $\bT$ is a sheaf. \qed(Claim) \\
    By surjectivity of $X \to \|X // R \|_0$ there exists a unique factorization 
    % https://q.uiver.app/#q=WzAsNCxbMCwwLCJYIl0sWzEsMCwiXFx8WCAvIFJcXHwiXSxbMiwwLCJUIl0sWzEsMSwiWSJdLFswLDEsIiIsMCx7InN0eWxlIjp7ImhlYWQiOnsibmFtZSI6ImVwaSJ9fX1dLFsxLDJdLFswLDNdLFszLDIsIlxcZXhpc3RzISIsMix7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFsxLDNdXQ==
\[\begin{tikzcd}
	X & {\|X // R\|_0} & T \\
	& Y
	\arrow[two heads, from=1-1, to=1-2]
	\arrow[from=1-1, to=2-2]
	\arrow[from=1-2, to=1-3]
	\arrow[from=1-2, to=2-2]
	\arrow["{\exists!}"', dashed, from=2-2, to=1-3]
\end{tikzcd}\]
making the right triangle commute. This is what we wanted to show.
\end{itemize}
\end{proof}

\begin{definition}
An equivalence relation $R$ on a type $X$ is called:
\begin{itemize}
\item  if for all $x,y:X$ the proposition $R(x,y)$ is a  $-1$-stack.
\item smooth if its  and for any $y:X$ its fibers:
\[R_y :\equiv \sum_{x:X} R(x,y)\]
are affine in $\bT$.
\end{itemize}
\end{definition}

\begin{lemma}\label{fundamental-propriety-algebraic-spaces}
Assume that $\bT$ satisfies descent for propositions and for sets \ref{thm:descent}, i.e. that a modal proposition being a  (-1)-stack is a sheaf. Assume that a modal set beeing affine in $\bT$ is a sheaf.
Assume given a $\bT$set $X$, then the following types are equivalent:
\begin{itemize}
\item The type of smooth equivalence relations over $X$.
\item The type of $\bT$sets $Y$ with identity types beeing  stacks and an $-1$-atlas $X$ to $Y$ (in V2 a $\bT$-cover).
\end{itemize}
\end{lemma}

\begin{proof}
By the equivalence in \ref{quotient-by-equivalence-relation}, it is enough to check that:
\begin{itemize}
\item The identity types in $X/R$ are 
 (-1)-stacks if and only if the relation $R$ is . For any $x,y:X$ we know that:
\[R(x,y) \simeq [x] =_{X/R}[y]\]
so the direct direction is immediate. For the converse we use the assumption that a modal proposition being a  (-1)-stack is a sheaf and that the map $[\_]:X\to X/R$ is $\bT$-surjective.
\item The fibers of: 
\[[\_]:X\to X/R\] 
are affine in $\bT$ if and only if the relation $R$ is smooth. For any $y:X$ we have that:
\[\sum_{x:X} R(x,y) \simeq \mathrm{fib}_{[\_]}([y])\]
so the direct direction is immediate. Here as well the converse follows from $\bT$-surjectivity of $[\_]$ and that the topology has descent.
\end{itemize}
\end{proof}
\begin{corollary}
    Assume $\bT$ satisfies descent for propositions and for sets.
    A type is a  0-stack iff its merely the $\bT$-quotient of an affine scheme by a smooth equivalence relation.
\end{corollary}
\begin{theorem}{\label{thm:QuotientOfAlgebraicSpace}}
    Assume $\bT$ satisfies descent for propositions. 
    The quotient of a  $0$-stack $X \in \bT \Set$ by an $0$-smooth equivalence relation $R$ is a  $0$-stack. TODO
\end{theorem}

\begin{proof}
The identity types in $X / R$ are propositional  0-stacks, hence $(-1)$-\truncation s of  -1-stacks by \ref{lemma:prop0stacks} as desired. \\
How to find an atlas: todo. How to proceed, if we could choose all atlasses we want at the same time?
% Motivation why the choice of atlasse should work: Let $T = X / R$. 
%  If we could choose -1-atlasses $\tilde X_t$ for the smooth 0-stacks $\fib_{[]}(t)$ for all $t : T$ at the same time, then $\sum_{t : T} \tilde X_t \to \sum_{t : T} \fib_{[]}(t) \to T$ has as domain a is fibered in smooth $-1$-stacks, as the fiber over $t$ would be $\tilde X_t$ which is an affine scheme in the topology. Moreover, This is enough as \\ %, hence by definition a smooth -1 stack. \\

%     Given $p_1 , p_2 : R \rightrightarrows X$ fibered in smooth $0$-stacks, hence the fibers merely have $-1$-atlasses.
%     %Claim: There exists a $-1$-atlas $R' \to R$
%     As $X$ has Local choice with respect to $-1$-atlasses, we find a $-1$ atlas $f : X' \to X$ with 
%     \[
%     \prod_{x' : X'} \text{-1-atlas}(\sum_{x : X} R(x,f(x'))
%     \]
    
\end{proof}
\begin{rmk}
    This is equivalent to saying that  $1$-stacks that are $0$-types are geomeric $0$-stacks: One direction we prove later. If $R$ is a 0-smooth equivalence relation on a  0-stack $X$, then $ X/ R$ is a  1-stack by observing that any -1-atlas $X' \to X$ gives a 0-atlas $X' \to X \to X/ R$. Moreover, $ X/ R$ is a 0-type, hence by assumption a  0-stack.
\end{rmk}

\begin{example}
    There are open affine subschemes $U$ of affine schemes $\Spec A$, which are not (disjoints unions of) principal open
\end{example}
\begin{proof}
    Consider $A = R[x,y,u,v]/(xy + ux^2 + vy^2), X= \Spec A$ and consider the open $U = D(x,y)$. \\
    We cant expect $U$ to be a disjoint union of principal opens (todo). However, $D(x,y)$ is affine: We have maps $U \to R$ given by
    $f = -v/x = (y+ux)/y^2 , g= -u/y = (x+vy)/x^2$. 
    Then $D(f) \cup D(g) = \Spec R^X$ , as $yf + xg = 1$ in $R^U$.
    Taking preimages under the affinization map, $U_f \cup U_g = X$ and one checks this defines an open affine cover (for example : $U_f \simeq \Spec R[x,u,f^{\pm 1}, g] / (xy + ux^2 + uy^2)$ with $y := (1-gx)/f$.)
    But on both of this open subsets the affinization map is an isomorphism
    hence the affinization of $X$ is an isomorphism.
    %\[R^X \simeq R^{D(f) \cup D(g)} \simeq R^{D(f)} \times_{R^{D(fg}} D(g) \]
    compare (Hartshorne II.2.17)
\end{proof}
% \begin{example}
%     The Zariski topology does not descent along $\bT$-covers between affines
% \end{example}
% \begin{proof}
% Assume it would hold.
% By the previous example pick such an open affine subset $U \subset \Spec A$ and pick a Zariski atlas $V \to U$ such that $V$ is mereley of the form $D(a_1) + \hdots + D(a_n)$ for some $a_i \in A$. Let $x : \Spec A$. Then pulling pack the Zariski atlas along $U(x) \to U$ gives us a Zariski atlas of the open proposition $V' \to U(x)$. Now $V' + 1 \to U(x) + 1$ is a Zariski atlas with total space in the Zariski topology. By assumption, $U(x) + 1$ is in the topology, hence $U(x)$ would be a sum of principal opens. As it is a propososition, it would be a principal open subset of $1$. 
% This is not a contradiction, because an open subset can be non principal although all the fibers are principal open props...
% This is a contradiction by the assumption on $U \subset \Spec A$ beeing not principal open.
    
% \end{proof}
\begin{lemma}
    Let $f : X \to Y$ be surjective. There exists a Zariski Cover $X' \to X$ such that $X' \to Y$ is a Zariski cover iff there exists a Zariski Cover $X' \to X$, some $n : \bN$ and an open affine embedding $X' \hookrightarrow Y^n$ over $Y$.
\end{lemma}

% \begin{lemma}
%     A morphism $f : X \to Y$ of  $n$-stacks is fibered in smooth $n$-stacks if there exists a smooth $n$-atlas of $f$.
% \end{lemma}

\section{Saturated Topologies revisited}

\begin{lemma}[1.1]{\label{lemma:smoothatlas}}
We want that every $n-1$-atlas of a smooth $n$-atlas has the additional requirement in the definition of smooth $n$-atlas. It turns out, that for this topology needs to be saturated:
The following are equivalent
\begin{enumerate}
   
    \item Beeing in the topology descents along $\bT$-covers between affines, i.e. $\bT$ is saturated.
    \item A smooth $n$ -stack $X$ that is an affine scheme lies in the Topology $\bT$.  
    \item Let $n \ge 0$. If $T$ is a smooth $n$-stack, then any $n-1$-atlas $U \to T$ satisfies $U \in \bT$.
     \item If $U \overset{f}{\to} V \overset{g}{\to} W$ are maps between affines and $f$ and $gf$ are $\bT$ covers, then $g$ is a $\bT$ Cover
\end{enumerate}
\end{lemma}
\begin{proof}
1 $\Rightarrow$ 2 \\
  Induction.
    This holds for $n=-1$. Assume it holds for $n-1$. Choose a $n-1$-atlas with $T$ source, i.e. $T \ni \Spec A \to X$ fibered in smooth $n-1$-stacks.  As it is affine, all the fibers of the atlas are affine smooth $n-1$-stacks, hence by induction they lie in $\bT$, thus the atlas is a $\bT$-cover between affines, hence $X \in \bT$. \\
    2 $\Rightarrow$ 3 \\
    As $U \to T$ is fibered in smooth $n-1$ stacks, all the fibers are in particular smooth $n$-stacks by \ref{lemma:succStab}. By stability under dependent sum $U = \sum_{t : T} U_t$ is a smooth $n$-stack that is affine, hence by assumption (2) it lies in the topology.\\
3 $\Rightarrow$ 1 \\
Let $X \to Y$ be a $\bT$-cover with $X$ affine in $\bT$ and $Y$ affine. Then $Y$ is a smooth $0$-stack, But $Y \to Y$ is a $-1$-atlas, hence by assumption $Y \in T$. 
\\
4 $\Rightarrow$ 1 \\
Obvious
\\
1 $\Rightarrow$ 4 \\
Check fiberwise
\end{proof}

 If $n \ge $, replacing $\bT$ by its saturation $\bT'$ does change the notion of  (smooth) $n$-stack, but we have the following statement, that tells us, that if we start with  0-$\bT$-stacks then the notion of smoothness does not see the difference between $\bT$ and its saturation. 
\begin{prop}
    Let $X$ be a  0-stack that is a weak smooth 0-stack, i.e. there exists a $\bT'$-atlas $\bT' \ni X' \to X$ (i.e. fibered in $\bT'$). Then $X$ is a smooth $0$-stack. 
\end{prop}
\begin{proof}
    Wlog $X' \in \bT$. Choose a $-1$-atlas $\Spec A \to X$ (i.e. fibered in $\bT$). As the fibers of $X' \to X$ merely have smooth atlasses $\tilde X_x' \to X'_x$, we can use Local choice to obtain a commutative diagram $Y = \sum_{x' : X'} \tilde X_x'$
    % https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXHRpbGRlIFgiXSxbMCwxLCJYJyJdLFsxLDEsIlgiXSxbMSwwLCJcXFNwZWMgQSJdLFszLDJdLFsxLDIsIlxcYlQnIiwyXSxbMCwxXSxbMCwzLCJcXGJUIl1d
% https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXHRpbGRlIFgiXSxbMCwxLCJYJyJdLFsxLDEsIlgiXSxbMSwwLCJcXFNwZWMgQSJdLFszLDJdLFsxLDIsIlxcYlQnIiwyXSxbMCwxLCJcXGJUIiwyXSxbMCwzLCJcXGJUIl1d
\[\begin{tikzcd}
	{\tilde X} & {\Spec A} \\
	{X'} & X
	\arrow["\bT", from=1-1, to=1-2]
	\arrow["\bT"', from=1-1, to=2-1]
	\arrow[from=1-2, to=2-2]
	\arrow["{\bT'}"', from=2-1, to=2-2]
\end{tikzcd}\]
As $Y \to X'$ is a$\bT$-cover and $X' \in \bT$ we conclude $Y \in \bT$. Hence we found a smooth $\bT$-atlas of $X$. 
\end{proof}
% \begin{prop}
%     Let $n \ge 0$. Replacing $\bT$ by its saturation $\bT'$ does change the notion of  (smooth) $n$-stack
% \end{prop}
% \begin{proof}
%     Induction. For $n = 0$ it is not clear, that if $X$ has an atlas fibered in $\bT'$, why it has an atlas fibered in $\bT$. TODO \\ REST IS CLEAR.
% \end{proof}
\subsection{Zariski Topology is not saturated}
\begin{example}[Weird Zariski Atlasses]{\label{ex:weirdZarAtlasses}}
    Assume those equivalent conditions on the Zariski topology.
    There exist Zariski atlasses of affines $\Spec A = X$ which are not of the form $D(a_1) + \hdots + D(a_n) \to \Spec A$ for $(a_1,\hdots,a_n) \in Um(A)$
\end{example}
\begin{proof}
     Indeed, using the first example, choose $U \subset \Spec A$ affine not principal open, then choosing a Zariski atlas $V \to U$ gives $V + X \to U + X \to X$ where $V + X \to X$ is a Zariski cover and $V + X \to U + X $ is a Zariski cover.
    From (4), we deduce that $U +X \to X$ is a Zariski cover, but $U$ is not a disjoint union of principal opens in $\Spec A$. 
\end{proof}
\begin{example}
     Assume those equivalent conditions on the Zariski topology. Every affine open proposition $U$ is principal open !
\end{example}
\begin{proof}
    Let $V \to U$ be a Zariski atlas. Then $V +1  \to U + 1$ is a Zariski atlas with $V+1 \in \bT$ and $U + 1$ affine, hence by (1) $U+ 1 \in \bT$, hence $U$ is a disjoint union of principal opens hence, as it is a proposition, its principal open.
 \end{proof}


% \begin{proof}
%     For the induction start, 
%     if this is true, choose an $n$-atlas $X \to T$ such that $X \in \bT$. Take $R = U \times_T X$ which is in $\bT$ (check!). Then $R \to U$ is a $\bT$-cover with $R \in \bT$, hence $U \in \bT$ by ($\star$). \\
%     Assume it holds for $(n-1)$. Choose an $n-1$-atlas $\bT \ni X \to T$. Then $R = U \times_T X$ is an $n-1$-stack, so we can choose a $n-2$-atlas $W \to R$. 
%     Claim: $W \to X$ and $W \to U$ are fibered in smooth $n-1$-stacks.
%     From there we conclude $W \in \bT$, hence $W \to U$ witnesses that $U$ is a smooth $n$-stack. Hence it lies in the topology by \ref{lemma:affinestack}.
%     %For any $x : X$ the basechange $W_x \to R_x$ is an $n-2$ atlas of a smooth $n-1$-stack, hence by induction $W_x \in \bT$. So $W = \sum_{x : X} W_x \in \bT$. By ($\star$)   
    
% \end{proof}
\section{ beeing a stack is indepent of the truncation level}


\begin{lemma}
    Let $n \ge 0$. A  $n$-stack is an modal $n$-type.
\end{lemma}
\begin{proof}
     The $n$-\truncation is an $n$-type. Now conclude by induction.
\end{proof}
We want to show that the notion of  stack makes sense, i.e. beeing  should not depend on the truncation level. 

\begin{lemma}{\label{lemma:prop0stacks}}
     Assume $\bT$ is saturated and satisfies descent for propositions. Let $P$ be a modal proposition. Then TFAE 
     \begin{enumerate}
         \item For some $m \ge 0$, $P$ is a  $m$ stack 

         \item There exists some fp algebra $A$ such that $\Spec A \to P$ and $P$ is logically equivalent to $(\Spec A \in \bT)$.
%		\item There exists some flat algebra $A$ such that $P \simeq \|\Spec A\|_T$
         \item $P$ is equivalent to $\| \Spec A \|_\bT$ for some fp $A$, i.e. $P$ is a  -1-stack.
     \end{enumerate}
     
     
\end{lemma}
\begin{proof}
\
    \begin{itemize}
        \item[$1.\Rightarrow 2.$]
    
     Let $\Spec A \to P$ be a $m-1$ atlas. Assume $\Spec A \in \bT$. Then $\|\Spec A\| \to P$ so as $P$ is a sheaf, we have $P$. Conversely, if $x : P$, then the fiber over $x$ is $\Spec A$ and a smooth $m-1$ stack, hence belongs to the topology by \ref{lemma:smoothatlas}. 
     \item[$2. \Rightarrow 3.$]
        \red{We have to show: There exists some fp algebra such that $P$ is logically equivalent to $\|\Spec A\|_\bT$. }        
        By assumption we have $\Spec A \to P$, so we deduce $\|\Spec A\|_\bT \to P$ as $P$ is a modal proposition. Conversely $P \to (\Spec A \in \bT) \to \|\Spec A\|_\bT$ , where the first arrow is by assumption.
        \item [$3. \Rightarrow 1.$] \ref{lemma:succStab}
%        \item [$2. \Rightarrow 3.$] 
     \end{itemize}
\end{proof}
\begin{lemma}
    A smooth $-1$-stack $P$ is contractible.
\end{lemma}
\begin{proof}
    Choose a $\bT$-cover $\bT \ni \Spec A \to P$. As $P$ is a proposition we have $\| \Spec A\| \to P$. As $P$ is a sheaf we have $P$.
\end{proof}
\begin{example}
    A  0-stack is a $\bT$-sheaf whose identity types are \red{(-1)-\truncation s of} (\affineA) schemes and there exists a $\bT$-atlas $\Spec A \to X$. \\
    Why are schemes  0-stacks? This holds in special case, for example if the scheme is quasi projective. 
\end{example}
\begin{theorem}{\label{thm:stack}}
    Let $\bT$ be saturated. Assume the topology satisfies descent Let $m , n \ge -2$. Given an $n$-type $T$ that is a  (smooth) $m$-stack then $T$ is a  (smooth) $n$-stack.
\end{theorem}


\begin{proof}
    
    By \ref{lemma:succStab} we may assume $m \ge n \ge -2$. \\
    If $m \le 1$ this is clear. Now assume $m \ge 2$. 
    Induction. 
    Inductionstart $m = 2$. Let us prove the case of $m = 2,n=1$, the cases $-2 \le n<1$ are immediate from this. \\
    Choose a 1-atlas $X' \to T$, i.e. its fibered in smooth $1$-stacks. As $T$ is a groupoid and $X'$ is a set, the fibers are actually sets, i.e. smooth 0-stacks. 
    
    Now consider $R := X' \times_T X'$. As $X'$ is in particular a  0-stack and  0-stacks are stable under dependent sums, $R$ will be a  0-stack. Choose a  a $\bT$-cover $R' \to R$ with $R'$ affine. Now $R' \to R \to X'$ is a map between affine schemes i.e it is fibered in smooth 0-stacks that are affine. As $\bT$ is saturated, the fibers of $R' \to X'$ are in $\bT$. As $X' // R'$ is a  1-stack by \ref{lemma:coeq}, it suffices to show that $X' // R' \to X' // R$ is a $\bT$-cover. Pick a term in $X' // R$. As the fiber beeing in $\bT$ is sheaf 
    If additionally $T$ is assumed to be a smooth $2$-stack, then we can assume $X'$ to be in the topology. This will force $R$ to be a smooth $0$-stack, so we may choose $R'$
    Assume $m > 2$ and the statement is proven for all $(n',m') < (n,m)$ in lexicographical ordering. As the identity types of $T$ are $n-1$-types and  $m-1$ stacks by induction they are  $n-1$ stacks. Let $X \to T$ be an $m-1$-atlas, i.e. fibered in smooth $m-1$-stacks with $X$ affine. The fibers are in particular $n-1$-types, so by induction they are smooth $n-1$-stacks. Hence $X \to T$ is an $n-1$-atlas. If, additionally $T$ is assumed to be a smooth $m$-stack, we can choose $X \in \bT$, hence $X \to T$ witnesses that $T$ is a smooth $n$-stack.
    
\end{proof}
\section{Stability under Quotients}
\begin{definition}
	A morphism between $n$-stacks is smooth if it is fibered in 
	\begin{itemize}
		\item $\bT$ if $n \le 0$
		\item smooth $n$-stacks if $n > 0$.
	\end{itemize}
\end{definition}
\begin{lemma}{\label{lemma:havingAbstractAtlasClosedUnderId}}
	Let $C$ be a class of affine schemes. The class of types $Y$ which admit a map $\Spec A \to Y$ fibered in $C$ is closed under taking identity types.
\end{lemma}
\begin{proof}
	By assumption we can choose a map $p : V \to Y$ out of an affine fibered in $C$. Let $y,y' : Y$.  Then we have the map
	\begin{align*}
		(\fib_p y) \times_V (\fib_p y') &\to y = y' \\
		(v , q : y = p v) , (v', q' : y' = p v') , (h : v = v') &\mapsto q \cdot h \cdot q'^{-1}
	\end{align*}
	The domain is a fiber product of affines, hence affine.
	The fiber over $j : y = y'$ looks like  %because $y$ and $y'$ are free we may only show the statement for the fiber over the path  $\mathsf{refl}_y : y = y$. 
	\[
	\sum_{v}  ( \underbrace{\sum_{v'} (h : v = v')}_{\mathsf{isContr}}) \times (q : y = p v) \times (q'  : y' = p v') \times (q \cdot h \cdot q'^{-1} = j) \simeq \sum_v (v = py) \simeq \fib_p y
	\]
\end{proof}
\begin{lemma}[TODO]{\label{lemma:missing}}
	If a modal proposition $P$ admits  a $-2$-atlas $\Spec A \to P$ then $P$ is a $-1$-stack.
\end{lemma}
\begin{theorem}{\label{thm:quotients}}
	Let $f : X \to Y$ be a $\bT$-surjective smooth morphism between modal $n$-types. If $X$ is a (smooth) stack , then $Y$ a  (smooth) stack.
\end{theorem}
\begin{proof}
	Induction.
	For $n = -2$ its clear.
	Let $X$ be a  $n$-stack. Lets first construct the $n-1$-atlas of $Y$.
	We merely find a $V \twoheadrightarrow X$ which is an $n-1$-atlas.  Then $V \to X \to Y$ is an $n$-atlas because it is $\bT$-surjective and is fibered in the correct $\sum$-stable class of types, i.e. $\bT$ if $n \le 1$ and  smooth $n-1$-stacks for $n > 1$. Hence $Y$ is an $n+1$-stack. As $Y$ is an $n$-type, $Y$ is an $n$-stack \ref{thm:stack}. \\
	If additionally $X$ is assumed to be smooth, then $V$ can be assumed to lie in $\bT$ which directly gives us that $Y$ has a smooth atlas. \\
	It remains to show that the identity types of $Y$ are  $n-1$-stacks. By \ref{lemma:havingAbstractAtlasClosedUnderId} we  find some $n-1$-atlas $p : W \to y=y'$. The map is smooth, because the fibers of $p$ are smooth. % because for $n \le 0$ $\bT$ and for $n > 0$ smooth $n-1$-stacks are stable under finite products. 
	If $n=0$, $y = y'$ is a $-1$-stack by \ref{lemma:missing}. If $n > 0$, $W$ is an $n-1$-stack and $p$ is smooth, so by induction $y = y'$ is an $n-1$-stack. %This is enough because choosing an $n$-atlas of the stack $(\fib_p y) \times_Y (\fib_p y')$ gives us by composition an $n$-atlas of $y = y'$. By induction ? $y = y'$ is an $n+1$-stack. By \ref{thm:stack} its an $n-1$-stack as desired.
\end{proof}
\section{Local properties}

\begin{definition}
Let \Cov be the property of morphisms of  $n$-stacks defined by asking that the morphism is $\bT$-surjective and fibered in smooth $n$-stacks. Its stable under basechange. A property of  $n$-stacks is local if $P(1)$ holds, $P$ is stable by dependent sums and given a \Cover  $X \to Y$ we have $P X$ iff $P Y$.
\end{definition}
\begin{example}    
    beeing smooth $n$-stack is a local property of stacks.
\end{example}
\begin{proof}
    We have to show: If $f : X \to Y$ is a $\bT$-surjective map fibered in smooth $n$-stacks between  $n$-stacks, then $X$ is a smooth $n$-stack iff $Y$ is a smooth $n$-stack.
    The only if is clear by stability under dependent sums. The other direction is \ref{thm:quotients}.
    
\end{proof}

\begin{definition}
    A property of morphisms between $n$-stacks is local, if it is satisfied by identities, stable under composition and basechange/descent along \Cov-maps, precomposition/right cancellability with \Cov-maps.
\end{definition}
\begin{lemma}
    Given a local property of types $P$. Then beeing fibered in $P$ is a local property of morphisms.
\end{lemma}
\begin{lemma}[\todocite]
    Given a local property $P$ of morphisms of $n$-stacks, a morphism $f : X \to Y$ has $P$ if there exists an $n$-atlas of $f$ having $P$.
\end{lemma}
\begin{example}
    A morphism of $n$-stacks is smooth iff there exists an $n$-atlas of $f$ 
    % https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXFNwZWMgQSJdLFsxLDAsIlxcU3BlYyBCIl0sWzAsMSwiWCJdLFsxLDEsIlkiXSxbMiwzLCJmIl0sWzAsMl0sWzEsM10sWzAsMSwiXFx0aWxkZSBmIiwyXV0=
\[\begin{tikzcd}
	{\Spec A} & {\Spec B} \\
	X & Y
	\arrow["{\tilde f}"', from=1-1, to=1-2]
	\arrow[from=1-1, to=2-1]
	\arrow[from=1-2, to=2-2]
	\arrow["f", from=2-1, to=2-2]
\end{tikzcd}\]
such that $\tilde f$ is a $\bT$-cover.
\end{example}r
The previous lemma tells us that we have the correct notion of smooth morphisms between  $n$-stacks for $n = 0,1$.


\end{document}

