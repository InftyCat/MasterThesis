\documentclass{article}
\newcommand{\Cov}{\emph{Cov} }
\newcommand{\affineA}{(affine ?)}
\newcommand{\Cover}{\emph{Cov}er }
\newcommand{\truncation}{$\bT$runcation}
%\newcommand{\Atl}{\emph{Atlas}}
\usepackage{graphicx} % Required for inserting images
\newcommand{\red}[1]{{\color{red} #1}}
\newcommand{\St}{\mathsf{St}}
\newcommand{\CS}{\mathsf{CS}}
\newcommand{\Zar}{\mathsf{Zar}}
\newcommand{\refl}{\mathsf{refl}}
\newcommand{\ap}{\mathsf{ap}}
\newcommand{\Aff}{\mathsf{Aff}}
\include{preamble}

\renewcommand{\GS}{\mathsf{GS}}
\title{Thesis}
\author{Tim Lichtnau }
\date{May 2024}

\begin{document}
\newtheorem*{warning}{Warning}
\newtheorem*{why}{Why I did it this way}
\newtheorem*{think}{Think about}
\maketitle
\include{Atlas}

\section{Preparation}


\begin{lemma}{\label{lemma:havingAbstractAtlasClosedUnderId}}
	Let $C$ be a class of types stable under $\sum$. %HOPE WE DONT NEED (because we want to apply it to \cV = covering stacks) finite limits, i.e. containing 1, stable under dependent sums and finite limits
	The class $\mathsf{HasAtlas}_C$ of types $Y$ which admit a map $\Aff \ni S \to Y$ fibered in $C$ is stable under identity types. %.  If it contains $C$ and is closed under dependent sums, then it is closed under taking identity types.
\end{lemma}
\begin{proof}
%	Obviously 1 has an atlas, and the class of types admitting an atlas is stable by $\sum$ by \ref{thm:atlasStableSum}.
%	It remains to show, that identity types in $Y$ have an atlas provided that $Y$ has an atlas.
	
	%This is a special case of stability under dependent sums. But lets prove it anyway.
	By assumption we can choose a map $\Aff \ni V \overset{p}{\to} Y$ fibered in $C$. Let $y,y' : Y$.  Then we have the map
	\begin{align*}
		(\fib_p y) \times_V (\fib_p y') &\to y = y' \\
		(v , q : y = p v) , (v', q' : y' = p v') , (h : v = v') &\mapsto q \cdot h \cdot q'^{-1}
	\end{align*}
	
	The fiber over $j : y = y'$ looks like  %because $y$ and $y'$ are free we may only show the statement for the fiber over the path  $\mathsf{refl}_y : y = y$. 
	\[
	\sum_{v}  ( \underbrace{\sum_{v'} (h : v = v')}_{\mathsf{isContr}}) \times (q : y = p v) \times (q'  : y' = p v') \times (q \cdot h \cdot q'^{-1} = j) \simeq \sum_v (v = py) \simeq \fib_p y
	\]
	Hence the map is fibered in $C$. It suffices to show, that	$(\fib_p y) \times_V (\fib_p y')$ has an atlas, because then we can compose such an atlas with the above map to obtain an atlas of $y = y'$.
	By assumption the fibers of $p$ have an atlas, so we can choose $q : W \to \fib_p y, q' : W' \to \fib_p y'$ atlasses. Then $W \times_V W' \to (\fib_p y) \times_V (\fib_p y')$ is an atlas: The domain is a fiber product of types in $\Aff$, hence it belongs to $\Aff$. The fiber over $(x,x')$ is equivalent to the product of fibers $(\fib_q x) \times (\fib_{q'} x')$ which is in $C$ by stability under dependent sums (so in particular under finite products).
	
\end{proof}
\begin{lemma}{\label{lemma:AtlasSum}}
	Let $\cU' \subset \cU$ be stable under dependent sums.
	Let $X$ be a type with a  map $p : U \to X$ fibered in $\cU'$.  For any $x : X$, let $Y_x$ be a type and moreover for any $u : U$, we are given a map $q_u : V_u \to Y_{p(u)}$ fibered in $\cU'$. Then the induced map
	\[
	p : \sum_{u : U} V_u \to \sum_{x : X} Y_{x}
	\]
	is fibered in $\cU'$
\end{lemma}
\begin{proof}
	The fiber of $p$ over some $(x,y) \in \sum_{x :X} Y_x$ is given by
	\[
	\sum_{u : \fib_p x} \fib_{q_u} (y') 
	\]
	where $y' : Y_{p(u)}$ (depending on $u$) is the transport of $y : Y_x$ along $x = p(u)$. As $\cU'$ is stable under dependent sum %(\ref{lemma:LexSumStable}, \ref{lemma:LexStability}), 
	those fibers are again in $\cU'$. This shows the result.
\end{proof}
\include{LexModalities}
\include{LocalChoice}
\include{Stacks}
\include{Descent}
\include{SaturatedTopology}
\include{LocalProperties}
\include{Flat}
\include{GeomPropositions}
\include{FundamentalThmAlgSpc}
\include{AlgebraicSpace}




\section{Deloopings and Truncations}

We denote $\| \cdot \|_n^\bT := L_\bT \| \cdot \|_n$, which is a modality.
\begin{definition}
	A pointed stack $(X,x)$ is called $\bT$-connected if for any $y : X$ we have $\|x = y\|_\bT$.
\end{definition}
\begin{definition}
	Let $G$ be a stack. A delooping stack of $G$ is a  pointed $\bT$-connected stack $B G$ equipped with an equivalence $\Omega B G \simeq G$.
\end{definition}

\begin{lemma}{\label{lemma:deloopingCS}}
	Let $G$ be a covering stack, that admits a delooping stack $B G$. Then $B G$ is a covering stack.
\end{lemma}
\begin{proof}
	Now assume $G$ is a covering stack. 	To show, that  $B G$ is a covering stack, we may show that the map $\bT \ni 1 \to B G$ is a geometric atlas. As $B G$ is $\bT$-connected, every point is $\bT$-merely equal to the basepoint. By descent for covering stacks, we may just show that the fiber over the basepoint is a covering stack
	But this is equivalent to $\Omega B G \simeq G$. 
\end{proof}
\begin{corollary}
	If $G$ is a covering group 0-stack,  that admits an $n$-fold delooping stack $B^n G$, then this will be a covering $n$-stack.
\end{corollary}
\begin{lemma}
	The fiber of $X \to \|X\|_n^\bT$ over $|x|$ is $\sum_{y : X} \| x = y\|_{(n-1)\bT}$
\end{lemma}
\begin{proof}
	For any $x : X$, we may show that the type family
	\begin{align*}
		B : \|X\|_n^\bT &\to \cU_{n-1}^\bT \\
		\|y\|_n &\mapsto \| x = y \|_{n-1}^\bT
	\end{align*}
	defined using the $n$ truncatedness of the stack $\cU_{n-1,\bT}$, is a unary identity system of $\|X\|_{n}^\bT$ at $|x|$. 
	By the fundamental system of identity types its enough to construct for all $y : \| X\|_n^\bT$, a section of the map $|x| = y \to B y$ induced by path induction. \\
	As the space of sections of a map between $n$-stacks is in particular an $n$-stack, we may just for all $y : X$ construct a section of the map 
	\[\mathrm{ind} : |x| =_{\|X\|_n^\bT} |y| \to \| x = y \|_{n-1}^\bT\]
	But $|x| = |y|$ is an $n-1$-stack, so there is a unique dashed map $\sigma$ such that the above triangle
% https://q.uiver.app/#q=WzAsNCxbMCwxLCJ8eHw9fHl8Il0sWzEsMSwiXFx8eCA9X1ggeSBcXHxfe259XlxcYlQiXSxbMSwwLCJ4ID1fWCB5Il0sWzEsMiwiXFx8eCA9X1ggeSBcXHxfe259XlxcYlQiXSxbMiwxLCJcXGV0YSJdLFsyLDAsIlxcYXAiLDJdLFsxLDAsIlxcc2lnbWEiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMSwzLCJcXGlkIl0sWzAsMywiXFxtYXRocm17aW5kfSIsMix7ImN1cnZlIjoyfV1d
\[\begin{tikzcd}
	& {x =_X y} \\
	{|x|=|y|} & {\|x =_X y \|_{n}^\bT} \\
	& {\|x =_X y \|_{n}^\bT}
	\arrow["\ap"', from=1-2, to=2-1]
	\arrow["\eta", from=1-2, to=2-2]
	\arrow["{\mathrm{ind}}"', curve={height=12pt}, from=2-1, to=3-2]
	\arrow["\exists! \sigma", dashed, from=2-2, to=2-1]
	\arrow["\id", from=2-2, to=3-2]
\end{tikzcd}\]
	commutes. This is indeed a section of the above map, because the maps $\mathrm{ind} \circ \sigma$ and $\id$ targeting an $n$-stack become equal after postcomposition with the unit $\eta$ of the modality $L_\bT \| \cdot \|_n$.
	
%	
%	
%	We may show, that the map
%	
%		For this we need that for all $x ,y : X$ the map
%	\[
%	\|x =_X y \|_{n-1,\bT} \to |x| =_{\|X\|_{n\bT}} |y|
%	\]
%	is an equivalence. 
 	
%	\[
%	\isContr \sum_{y : \|X\|_n^\bT} B y \simeq \prod_{y : \|X\|_n^\bT} \prod_{t : By}(p : |x| = y) \times (\tp_p r = t)
%	\]
%	where $r : B |x|$ is defined as $| \refl_x|$. \\
%	So Let $x : X$. For any such $y$ the type $\prod_{t : By}(p : |x| =_{\|X\|_n^\bT} y) \times (\tp_p r = t)$ is an $n$-stack so we may just provide a term in
%	\[
%	\prod_{y : X} \prod_{t : \| x = y\|_{n-1,\bT}}(p : |x| =_{\|X\|_n^\bT} |y|) \times (\tp_p r = t)	
%	\]
%	Let $y : X$. For any such $t$, as $(p : |x| =_{\|X\|_n^\bT} |y|) \times (|p| = t)$ is a $n-1$-stack, we may just construct a term in
%	\[
%	\prod_{t : x = y} (p : |x| = |y|) \times \tp_p r = |t|
%	\]
%	this is obvious by setting $p := \mathsf{ap}_{|\_|} t$ and we compute
%	\[
%	\tp_{\ap_{|\_|} t} |\refl_x| = | t \cdot \refl_x | = |t|
%	\]
\end{proof}
\begin{lemma}
	For any $X$ and any $n \ge -1$, the map $X \to \|X\|_n^\bT$ is $\bT$-surjective.
\end{lemma}
\begin{proof}
	It factors as $X \to \|X\|_n \to L_\bT \|X\|_n$ where the latter map is $\bT$-surjective. So it sufficess to show, that the former map is surjective. As $X \to \|X\|_0$ is surjective it suffices to show, that $\ap$ of the map $\|X\|_n \to \|X\|_0$ is surjective. TODO %But for any type $T$ the map $T \to \|T\|_0$ is surjective.
\end{proof}
\begin{prop}
	Let $X$ be a geometric stack, such that for all $x : X$, $\Omega^{n+1} (X , x)$ is a covering stack for all $x : X$. Then $\|X\|_n^\bT$ is a geometric $n$-stack.
\end{prop}
\begin{proof}
	As $X$ is a geometric stack it suffices to show, that the $\bT$-surjection map $X \to \|X\|_n^\bT$ is a geometric cover.
	Let us show by induction over $k = -1,\hdots,n$ that 
	\[\Omega^{n - k} X \to \|\Omega^{n - k} X\|_k^\bT\]
	is a geometric cover.  \\
	$k=-1$ is okay as $\Omega^{n+1} X$ is a covering stack and $\bT$-truncations of covering stacks are contractible. \\
	For the induction step $k - 1 \mapsto k$:
	Set $X' := \Omega^{n-k} X$, so we want to show that $X' \to \|X'\|_k^\bT$ is a geometric cover.
	Every fiber is modal so the fiber beeing a covering stack has descent, so we may just show that the fiber over the image of some $x : X$ is a covering stack. The fiber $\sum_{y : X} \| x = y\|_{(k-1)\bT}$ is $\bT$-connected, so its a delooping stack of 
	\[(p : \Omega X) \times \left(\tp_p r =_{\|\Omega X\|_{k-1,\bT}} r  \right),\]
	where $ r= |\refl|$.
	By \ref{lemma:deloopingCS} it suffices to show that this is a covering stack. But we calculate $\tp_p r = |p|$, so it is the fiber of 
	\[
	\Omega X  \to \|\Omega X \|_{k-1, \bT}
	\]
	over the basepoint $|\refl|$.
\end{proof}


\begin{definition}
	A higher group stack is a pointed $\bT$-connected stack.
\end{definition}
Let $BG$ be a higher group stack and $X$ be a geometric stack equipped with an action $\rho : BG \to \GS$. We use the standart notation

\[
X // G :\equiv \sum_{BG} \rho
\]
\begin{lemma}
 If $G$ is covering, then $X // G$ is a geometric stack
\end{lemma}
\begin{proof}
	$BG$ is a covering stack, as $G$ is a covering stack \ref{lemma:deloopingCS}. Hence $X // G :\equiv \sum_{BG} \rho$ is a geometric stack.
\end{proof}
\begin{prop}
	%Let $BG$ be a higher group stack and $X : BG \to \GS$ be a geometric $G$-stack. 
	If $X // G$ is a geometric stack (e.g. if $G$ is covering) and the isotropy stacks $\sum_{g : G} g x = x$ are covering stacks, then $\| X // G \|_0^\bT$ is an algebraic space.
\end{prop}
\begin{proof}
	To apply the prop, we have to show, that for all $x : X // G$, $\Omega (X // G,x)$ is a covering stack. As $X \to X // G$ is $\bT$-surjective (todo details), we may just show this for $x : X$.
	\[
	\Omega (X // G , [x]) \simeq \sum_{g: G} g x = x
	\]
	which was covering by assumption
\end{proof}
\begin{corollary}
	Let $X$ be a geometric stack, whose identity types are covering stacks. Let $G$ be a finite group acting on $X$. Then $L_\bT (X / G)$ is a geometric stack.
\end{corollary}
\begin{proof}
	 The isotropy stacks are covering, as they are $\sum$ of covering stacks.
\end{proof}
We can also reprove \ref{lemma:algSpacesStabFreeQuots}: $G$ is a finite type by assumption, hence covering. The isotropy stacks are assumed to be propositions, but they are inhabited, so they are covering \qed(lemma) \\

TODO: Find a good example of a non covering $G$.


%Observe by stability under $\sum$ this is an geometric stack, if $BG$ is geometric.


%The definition is reasonable because the following
\end{document}

 