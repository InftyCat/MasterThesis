\documentclass{article}
\newcommand{\Cov}{\emph{Cov} }
\newcommand{\affineA}{(affine ?)}
\newcommand{\Cover}{\emph{Cov}er }
\newcommand{\truncation}{$\bT$runcation}
%\newcommand{\Atl}{\emph{Atlas}}
\usepackage{graphicx} % Required for inserting images
\newcommand{\red}[1]{{\color{red} #1}}
\newcommand{\St}{\mathsf{St}}
\newcommand{\CS}{\mathsf{CS}}
\newcommand{\Zar}{\mathsf{Zar}}
\newcommand{\refl}{\mathsf{refl}}
\newcommand{\ap}{\mathsf{ap}}
\newcommand{\Aff}{\mathsf{Aff}}
\newcommand{\Sep}{\mathsf{Sep}}
\include{preamble}

\renewcommand{\GS}{\mathsf{GS}}
\title{Thesis}
\author{Tim Lichtnau }
\date{May 2024}

\begin{document}
\newtheorem*{warning}{Warning}
\newtheorem*{why}{Why I did it this way}
\newtheorem*{think}{Think about}
\maketitle
\tableofcontents
\include{Atlas}

\section{Preparation}


\begin{lemma}{\label{lemma:havingAbstractAtlasClosedUnderId}}
	Let $C$ be a class of types stable under $\sum$. %HOPE WE DONT NEED (because we want to apply it to \cV = covering stacks) finite limits, i.e. containing 1, stable under dependent sums and finite limits
	The class $\mathsf{HasAtlas}_C$ of types $Y$ which admit a map $\Aff \ni S \to Y$ fibered in $C$ is stable under identity types. %.  If it contains $C$ and is closed under dependent sums, then it is closed under taking identity types.
\end{lemma}
\begin{proof}
%	Obviously 1 has an atlas, and the class of types admitting an atlas is stable by $\sum$ by \ref{thm:atlasStableSum}.
%	It remains to show, that identity types in $Y$ have an atlas provided that $Y$ has an atlas.
	
	%This is a special case of stability under dependent sums. But lets prove it anyway.
	By assumption we can choose a map $\Aff \ni V \overset{p}{\to} Y$ fibered in $C$. Let $y,y' : Y$.  Then we have the map
	\begin{align*}
		(\fib_p y) \times_V (\fib_p y') &\to y = y' \\
		(v , q : y = p v) , (v', q' : y' = p v') , (h : v = v') &\mapsto q \cdot h \cdot q'^{-1}
	\end{align*}
	
	The fiber over $j : y = y'$ looks like  %because $y$ and $y'$ are free we may only show the statement for the fiber over the path  $\mathsf{refl}_y : y = y$. 
	\[
	\sum_{v}  ( \underbrace{\sum_{v'} (h : v = v')}_{\mathsf{isContr}}) \times (q : y = p v) \times (q'  : y' = p v') \times (q \cdot h \cdot q'^{-1} = j) \simeq \sum_v (v = py) \simeq \fib_p y
	\]
	Hence the map is fibered in $C$. It suffices to show, that	$(\fib_p y) \times_V (\fib_p y')$ has an atlas, because then we can compose such an atlas with the above map to obtain an atlas of $y = y'$.
	By assumption the fibers of $p$ have an atlas, so we can choose $q : W \to \fib_p y, q' : W' \to \fib_p y'$ atlasses. Then $W \times_V W' \to (\fib_p y) \times_V (\fib_p y')$ is an atlas: The domain is a fiber product of types in $\Aff$, hence it belongs to $\Aff$. The fiber over $(x,x')$ is equivalent to the product of fibers $(\fib_q x) \times (\fib_{q'} x')$ which is in $C$ by stability under dependent sums (so in particular under finite products).
	
\end{proof}
\begin{lemma}{\label{lemma:AtlasSum}}
	Let $\cU' \subset \cU$ be stable under dependent sums.
	Let $X$ be a type with a  map $p : U \to X$ fibered in $\cU'$.  For any $x : X$, let $Y_x$ be a type and moreover for any $u : U$, we are given a map $q_u : V_u \to Y_{p(u)}$ fibered in $\cU'$. Then the induced map
	\[
	p : \sum_{u : U} V_u \to \sum_{x : X} Y_{x}
	\]
	is fibered in $\cU'$
\end{lemma}
\begin{proof}
	The fiber of $p$ over some $(x,y) \in \sum_{x :X} Y_x$ is given by
	\[
	\sum_{u : \fib_p x} \fib_{q_u} (y') 
	\]
	where $y' : Y_{p(u)}$ (depending on $u$) is the transport of $y : Y_x$ along $x = p(u)$. As $\cU'$ is stable under dependent sum %(\ref{lemma:LexSumStable}, \ref{lemma:LexStability}), 
	those fibers are again in $\cU'$. This shows the result.
\end{proof}
\include{LexModalities}
\include{LocalChoice}
\include{Stacks}
\include{Descent}
\include{SaturatedTopology}


\include{GeomPropositions}
\include{FundamentalThmAlgSpc}
\include{AlgebraicSpace}


\include{LocalProperties}
\include{Flat}
\include{DeloopingsAndTruncations}


\subsection{Weakly-flat stacks}
\begin{definition}
	We call a geometric stack $X$ weakly-flat iff one of the following conditions is satisfied
	\begin{enumerate}
		\item $\|X\|_{-1}^\bT \to X \in \CS$
		\item For any geometric atlas $W \to X$ , $W$ is weakly-flat, i.e $\|W\|^\bT \to W \in \bT$.
	\end{enumerate}

\end{definition}
\begin{proof}
	\ \begin{enumerate}
		\item [1 $\Rightarrow$ 2] Choose a geometric atlas $W \to X$. In particular its $\bT$-surjective, hence we have $\|W\|^\bT$, so by assumption $W \in \bT$. So $X \in CS$.
		\item [2 $\Rightarrow$ 1] 
		\[\|W\|^\bT \to \|X\|^\bT \to X \in \CS \overset{\ref{lemma:atlasIsCatlas}}{\to} W \in \bT \]
	\end{enumerate}
\end{proof}
They behave bad as they are not stable under $\sum$ (and not under $\id$-types, although this holds for affines).
%		\item 
%
\begin{lemma}
For any weakly-flat geometric stack $X$, $\|X\|_{-1}^\bT$ is a geometric stack.
\end{lemma}
\begin{proof}
	$X \to \|X\|_{-1}^\bT$ is a geometric cover.
\end{proof}
\begin{prop}{\label{prop:TruncationCover}}
	We may define $X$ to be $0$-wf-seperated, iff its weakly flat and $n+1$-wf-seperated, iff identity types of $X$ are $n$-wf-seperated. \\
	%Assume that loopspaces of covering stacks are covering. TFAE
	For $X$ a geometric stack, TFAE \begin{enumerate}
	%	\item $X \to \|X\|_n^\bT$ is a geometric cover
		\item  $X$ is $n+1$-wf-seperated, i.e. all $n+1$-fold identity types of $X$ are weakly-flat.
	
		\item For any $x$, $\Omega^{n+1} (X , x)$ is covering.
		\item For any $x: X$ , $x=x$ is $n$-wf-seperated, i.e. $n$-fold identity types of $x=x$ are weakly flat. %For any sequence $x_0 : X \equiv X_0$ , $x_{k+1} : (x_{k} =_{X_k} x_k) \equiv X_{k+1}$, $x_n =_{X_n} x_n$ is covering.
	\end{enumerate}

\end{prop}
\begin{proof}
	
%	Claim: A stack beeing $n$-wf-seperated has descent.
%	\item [3 $\Rightarrow$ 1] already done
	\item [1 $\Rightarrow$ 3 $\Rightarrow$ 2] ez
%	\item [1 $\Rightarrow$ 3]

%	If for any $x$ , the fiber of $\eta_n^\bT X$ over $|x|$ is covering, then its $n+1$-fold loop space covering by assumption, so also $\Omega^{n+1} (X , x)$.	
	\item [3 $\Rightarrow$ 1] We prove this by induction. $n = 0$. To show that $x =_{X} y$ is weakly-flat, by descent we may assume that $x = y$. Then we have $(x = y) \simeq (x =_{X} x)$. By assumption this is weakly flat. \\
	Assume now, that for any $x : X$, that $x = x$ is $n$-wf-seperated. Let $x, y : X$. We want to show that $x = y$ is $n$-wf-seperated. By induction we may just prove that for any $p : x = y$, $p = p$ is $n-1$-wf-seperated. Applying $p \cdot \_$ induces an equivalence $\refl_x = \refl_x \simeq p = p$ . But $x = x$ is $n$-wf-seperated, hence $\refl_x = \refl_x$ is $n-1$-wf-seperated.
	\item [2 $\Rightarrow$ 3] Induction. $n=0$ is fine. 
	Let $x : X$. To show that $\Omega(X,x)$ is $n$-wf-seperated, just use that $\Omega^n(\Omega(X,x))$ is covering, hence by the inductive statement $2 \Rightarrow 3 \Rightarrow 1$, we now that $\Omega(X,x)$ is $n$-wf-seperated.
	%Applying $x_k \cdot \_$ from the left induces an equivalence
%	\[\refl =_{X_k} \refl \to x_k =_{X_k} x_k \]
%	Conclude inductively
\end{proof}
\subsection{Omega-stability and gerbes}
\begin{definition}
	A geometric stack $X$ is an $n$-gerbe iff the map $\eta_n^\bT : X \to \|X\|_n^\bT$ is a geometric cover.
\end{definition}

\begin{theorem}
	Assume that Covering stacks are $\Omega$-stable, % either that loop spaces of covering spaces are covering or that .\\
	Then every geometric stack is a 1-gerbe. %For any geometric stack $X$, the map $X \to \|X\|_1^\bT$ is a geometric cover. In particular $\|X\|_1^\bT$ is a geometric stack.
\end{theorem}
\begin{proof}
	By \ref{prop:LoopingsImplyGerbe}, we need to show that for any $x : X$, $\Omega^2(X,x)$ is covering.
	choose an geometric atlas $f : S \to X$. by descent we may only show that $\Omega^2(X , fs)$ for $s : S$ is covering.
	%	 % https://q.uiver.app/#q=WzAsMTAsWzMsMSwiMSJdLFszLDIsIlgiXSxbMiwyLCJTIl0sWzIsMSwiXFxzdW1fe3QgOiBTfWZ0ID1fWCBmcyJdLFsxLDEsImZzID0gZnMiXSxbMSwyLCIxIl0sWzEsMCwiMSJdLFsyLDAsIjEiXSxbMCwwLCJcXE9tZWdhKGZzID0gZnMpIl0sWzAsMSwiMSJdLFsyLDEsImYiXSxbMCwxLCJmcyJdLFszLDJdLFszLDBdLFs1LDIsInMiXSxbNCw1XSxbNCwzXSxbNywzLCIocyxcXHJlZmwpIl0sWzYsNF0sWzYsN10sWzksNCwiXFxyZWZsIl0sWzgsNl0sWzgsOV1d
	%	 \[\begin{tikzcd}
	%	 	{\Omega(fs = fs)} & 1 & 1 \\
	%	 	1 & {fs = fs} & {\sum_{t : S}ft =_X fs} & 1 \\
	%	 	& 1 & S & X
	%	 	\arrow[from=1-1, to=1-2]
	%	 	\arrow[from=1-1, to=2-1]
	%	 	\arrow[from=1-2, to=1-3]
	%	 	\arrow[from=1-2, to=2-2]
	%	 	\arrow["{(s,\refl)}", from=1-3, to=2-3]
	%	 	\arrow["\refl", from=2-1, to=2-2]
	%	 	\arrow[from=2-2, to=2-3]
	%	 	\arrow[from=2-2, to=3-2]
	%	 	\arrow[from=2-3, to=2-4]
	%	 	\arrow[from=2-3, to=3-3]
	%	 	\arrow["fs", from=2-4, to=3-4]
	%	 	\arrow["s", from=3-2, to=3-3]
	%	 	\arrow["f", from=3-3, to=3-4]
	%	 \end{tikzcd}\]
	%By pullback pasting every square is a pullback. Hence 
	
	% 	\[
	% 	\Omega(fs = fs) \simeq \Omega(\sum_{t : S} ft = fs) 
	% 	\]
	\[
	\Omega(\sum_{t : S} ft = fs) \simeq \left (\sum_{p : \Omega(S,s)} \tp_p (\refl_{f s}) = \refl_{f s} \right) \simeq \refl =_{f s = f s} \refl
	\]
	where the last equivalence is obtained, as $\Omega(S,s)$ is contractible with center $\refl_s$.
	
	So $\Omega^2(X,fs)$ is the loop space of a covering stack, hence by assumption covering.
\end{proof}
\begin{prop}{\label{prop:GerbeIffLooping}}
	This proposition seems only interesting for $n = 0$ by the previous theorem. Assume that covering stacks are $\Omega$-stable. Then $X$ is an $n$-gerbe iff $\Omega^{n+1}(X,x)$ is covering for all $x: X$	
\end{prop}
\begin{proof}
	One direction is \ref{prop:LoopingsImplyGerbe}. The other follows
	
	By applying iteratively \ref{lemma:loopOfFiber} 
	\begin{align*}
		\Omega^{n+1} (\fib (\eta_n^\bT X) |x|) &\simeq \Omega^n \fib (\eta_{n-1}^\bT (\Omega (X,x))) pt \simeq \hdots \\
		&\simeq \Omega^{n-k} \fib(\eta_{n-k-1}^\bT \Omega^{k+1}(X,x)) pt \simeq \hdots \\
		&\simeq \fib (\eta_{-1}^\bT \Omega^{n+1} (X,x)) pt \\
		&\simeq \Omega^{n+1} (X , x)
	\end{align*}
	The LHS is covering by $\Omega$-stability.
\end{proof}

%The goal of this subsection is the following:


\begin{lemma}
	If the topology is flattened by some $\bP$ that is stable under $\id$-types, then Covering stacks are $\Omega$-stable
\end{lemma}
\begin{proof}
	If $X$ is a covering stack then $\Omega X$ is a $\bP$ geometric stack and $\bT$-merely inhabited. Conclude by  \ref{lemma:detectCovering}.
\end{proof}
\begin{example}
	Put $\bP$ = formally \etale $+$ flat. Then $\bP$ is stable under identity types as formally \etale seperated schemes have decidable equality. 
\end{example}

%
%\begin{lemma}
%	Given a geometric atlas $p : X_0 \to X$ of a geometric stack $X$, $\|X_0 \times_X X_0\|_0^\bT$ is an algebraic space, iff for any $x, y : X$ , $\| x =_X y \|_0^\bT$ are algebraic spaces.	
%\end{lemma}
%\begin{proof}
%	The map $p : X_0 \to X$ is $\bT$-surjective, so by descent we may just show the respective statement for $p x, p y : X$ for $x ,y : X_0$. 
%	Now we use 	that the fibers of the map
%	\[
%	\|X_0 \times_X X_0\|_0^\bT = \sum_{x y : X_0} \| x =_X y\|_0^\bT \to X_0 \times X_0 
%	\] %= \sum_{x , y} |x| =_{\|X\|_1^\bT} |y|
%	are geometric stacks iff the domain is a geometric stack.
%	
%\end{proof}
%\begin{lemma}
%	TFAE
%	\begin{enumerate}
%		\item  Any geometric atlas $X_0 \to X$ satisfies that $p_1 : \|X_0 \times_X X_0\|_0^\bT \to X_0$ is covering
%		\item $X \to \|X\|_1^\bT$ is covering
%		\item  $\Omega^2(X,x)$ is covering for all $x : X$. 
%	\end{enumerate}
%
%\end{lemma}
%\begin{proof}
%	2. and 3. are equivalent by \ref{prop:TruncationCover}. Choose a geometric atlas $X_0 \to X$. Then 
%	\[
%	\|X_0 \times_X X_0\|_0^\bT \simeq \| \sum_{x y : X_0} p x =_X py \|_0^\bT \simeq \sum_{x y  : X_0} \| px  =_X p y \|_0^\bT = \sum_{x y : X_0} |x| =_{\|X\|_1^\bT} |y| \simeq X_0 \times_{\|X\|_1^\bT} X_0
%	\]
%	So $\|X_0 \times_X X_0\|_0^\bT \to X_0$ is covering iff $X_0 \to \|X\|_1^\bT$ is covering iff $X \to \|X\|_1^\bT$ is covering by stability under covers.
%\end{proof}

	%	$X \to \|X\|_0^\bT$ is a geometric cover iff for all $x : X$, $\sum_{y : X} \|x = y\|^\bT$ is covering. If the identity types are weakly-flat then 
%\[
%\bT \ni 1 \simeq \sum_{y : X} x = y \to \sum_{y : X} \| y = x\|^\bT
%\]
%is a geometric catlas. \\
\section{Not clear where to put that}
\begin{prop}
	Assume covering stacks are $\Omega$-stable.
	A $\bT$-merely inhabited truncated stack (e.g. geometric stack) is covering iff $\pi_0^\bT X := \|X\|_0^\bT$ and all higher homotopy groups 
	\[
	\pi_i^\bT(X,x) = \|\Omega^i (X , x)\|_0^\bT , i \ge 1
	\]
	are covering algebraic spaces.
\end{prop}
\begin{proof}
	Let $X$ be an $n$-stack.
	If $X$ is covering, then by $\Omega$-stability all the $\pi_i^\bT$ are covering \ref{prop:GerbeIffLooping} Now the converse.
	Consider the postnikov tower
	\[
	X = \|X\|_n^\bT \to \|X\|_{n-1}^\bT \to \hdots \to \|X\|_1^\bT \to \|X\|_0^\bT 
	\]
	As $\|X\|_0^\bT$ is covering, by quotient stability of covering stacks we may show that all the maps are geometric covers. 
	Let $1 \le k \le n$ and consider the map $\|X\|_{k}^\bT \to \|X\|_{k-1}^\bT$. By descent for covering stacks, we may only consider the fiber over $|x|$, as the $\eta_{k-1}^\bT$ is $\bT$-surjective. 
	It suffices to show, that the fiber is given by $B_\bT^k \pi^\bT_k(X,x)$ as deloopings of covering stacks are covering \ref{lemma:deloopingCS}.\\	
	TODO details		
\end{proof}
\end{document}

\section{Questions}
\begin{theorem}[TODO]
	An Artin stack $X$ is Deligne Mumford iff one of the following conditions is satisfied:
	\begin{enumerate}
		\item There exists a geometric atlas $W \to X$
		\item The identity types of $X$ are $\bP$-seperated
	\end{enumerate}
\end{theorem}
\begin{proof}
	\begin{enumerate}
		\item [1. $\Rightarrow $2.] \ref{lemma:DMUnrIdTypes}
		\item [2. $\Rightarrow$ 1] Residual gerbes??? [06MF]
		%As a stack beeing $\bP$-seperated is a sheaf and $%
	\end{enumerate}
\end{proof}


 