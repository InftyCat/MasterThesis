
\section{Covering stacks}
Fix $\bT$ a topology, which we call the covering-affines.
\begin{definition}
	covering stacks are the smallest class containing contractible Types such that: If $Y$ is a stack and $\bT \ni S \to Y$ is fibered in covering stacks, then $Y$ is a covering stack.	
\end{definition}
We call such map $X \to Y$ whose fibers are covering stacks a geometric cover. If $X$ is affine we call it a geometric atlas. If $X$ is in $\bT$ we call it a geometric catlas. 
\begin{definition}
	We call $X$ a geometric stack if it merely has a geometric atlas, i.e some $\Spec A \to X$ fibered in covering stacks.
\end{definition}
\begin{prop}[Recursion principle for covering / geometric stacks]
	Let $P$ be a property of covering / geometric stacks. Assume
	\begin{itemize}
		\item contractibles have $P$
		\item If $S$ is (covering) affine and $S \to Y$ is fibered in covering stacks having $P$ then $Y$ has $P$
	\end{itemize}
	Then every covering / geometric stack has $P$.
\end{prop}
%\begin{proof}
%	Replace $P$ by $P \land \mathsf{is-covering-stack}$. Then usual induction
%	
%\end{proof}
\begin{why}
	Should $P$ be defined more generally for all sheaves?
	No, because we want for the recursion principle for geometric stacks, that the fibers are covering stacks (proof of truncatedness).
%	If $P$ is defined only for covering stacks, do we need to talk about $P$-covers between covering stacks without knowing that the fibers are covering stacks as well?
\end{why}
\begin{prop}{\label{prop:csHasAtlas}}
Every covering stack $X$ merely admits a geometric catlas. %, i.e. a geometric cover $Y \to X$ with $Y \in \bT$. 
\end{prop}

\begin{proof}
%We apply the recursion principle of covering / geometric stacks 
\begin{itemize}
	\item If 	$X$ is covering affine, then $X \to X$ is a geometric catlas. 
	\item If $X$ is obtained as a quotient then it already is equipped with a catlas. %, i.e. if its equipped with a cover $Y \to X$ with $Y$ a covering stack, then by induction $Y$ admits a $\cV$-catlas $S \to Y$. Then $S \to Y \to X$ is a $\cV$-catlas by  \ref{lemma:coversstableundercomp}. \\
	%\item If $X$ is obtained as a sum, i.e. we have a $\cV$-cover $f : X \to Y$, then by induction $Y$ admits an $\cV$-catlas $g : S \to Y$ and the fibers merely have $\cV$-catlasses $S_y \to \fib_f y$ s. By choice of $S$, we can choose such catlasses $S_{g s} \to \fib_f (g s)$ for all $s : S$. By \ref{lemma:AtlasSum} the map 
	%\[
	%\sum_{s : S} S_{gs} \to (\sum_{y: Y} \fib_f y ) \simeq X
	%\]
	%is a $\cV$-cover. Its domain is a covering affine as $\bT$ is $\sum$-stable. Hence $X$ admits a $\cV$-catlas .
	
\end{itemize}
\end{proof}

\subsection{Needing finitely many steps}
In this subsection we want to prove that one could equivalently define covering stacks just by induction over the natural numbers.

\begin{lemma}{\label{lemma:cstinh}}
	Every covering stack $X$ is $\bT$-merely inhabited.
\end{lemma}
\begin{proof} 
	\begin{itemize}
		\item If $X$ is in $\bT$ then its clear.
		\item  If $X$ is obtained by a quotient, we have a map $\Spec A \to X$ with domain in $\bT$. Now use that we get a map on $\bT$-propositional-truncations and that Spec A is T-merely inhabited.
		%		\item if $X$ is obtained by  $X = \sum_{y: Y} B y$ for $Y$ a covering $\cV$-stack and $B y$ covering $\cV$-stacks, by induction all the $B y$ are $\bT$-merely inhabited. Hence, for all $y : Y$, we can conclude $\| X\|_\bT$. As $Y$ is $\bT$-merely inhabited by induction and the goal is a stack, we can conclude. 
	\end{itemize}
\end{proof}
\begin{prop}{\label{prop:FindCommonN}}
	Given a geometric stack $Y$ and a family $M : Y \to (\bN \to \Prop_{\ci})$  be a family of upwards closed merely inhabited subsets of $\bN$. Then there exists some $n$, such that $M y n$ for all $y : Y$.
\end{prop}
\begin{proof}
	Write $M_n = \{y : Y \ | \ M y n\}$.
	Choose a geometric atlas $f : S \to Y$.
	For any $x : S$, $M(f x) n$ for some $n$. By foundations Prop 3.3.5, we merely find some $n$ such that $f(x) \in M_n$ for all $x : S$. Let us show that for general $y : Y$ we have $y \in M_n$. Using that $y \in M_n$ is modal , we can conclude by $\bT$-surjectivity of $f$, which follows from \ref{lemma:cstinh}
	
\end{proof}
\begin{prop}{\label{prop:OneToRuleThemAll}}
	Let $W : \GS \to (\bN \to \Prop_{\ci})$ be a family of upwards closed subsets of $\bN$. Assume
	\begin{itemize}
		\item $W 1$ is merely inhabited
		\item whenever there is some $n : \bN$ and a geometric atlas $S \to X$ fibered in covering stacks $F$ satisfying $W F n \equiv: W_n F$, then $W_{n+1} X$.
	\end{itemize}  %(or more generally $W X$ is merely inhabited). 
	Then for any $X \in \GS$, $W X$ is merely inhabited.
\end{prop}

\begin{proof}
		We apply the recursion principle for geometric stacks.
	\begin{itemize}
		\item If $Y$ is contractible its clear by assumption
		\item Assume $Y$ is equipped with a geometric atlas $f : S \to Y$, such that every fiber has $W_n$ for some $n$. Apply \ref{prop:FindCommonN} to $M y n = W_n (\fib_f y)$ to find some $n$ such that $W_n (\fib_f y)$ for all $y : Y$.
		Then we can conclude by applying the assumption.
	
		%	\item Let $X$ be an $n$-truncated covering stack. By \ref{prop:csHasAtlas} we find a geometric catlas $S \to X$. All the fibers are (at most) $n$-truncated. 	
	\end{itemize}
\end{proof}


\begin{definition}
	Define \begin{align*}
		W_0 &\equiv \bT \\
		W_{n+1} &\equiv \{X \ stack \ | \  X \text{ has a } W_n-catlas \}
	\end{align*}
\end{definition}
\begin{why}
	$W 0 $ is not defined as $\isContr$, because for $\sum$ stability later, we want to apply \ref{thm:atlasStableSum}, so we need that Zariski covers are allowed covers.
\end{why}
\begin{lemma}
	$W$  is monotone
\end{lemma}
\begin{proof}
	We prove $\forall n . W n \subset W (n+1)$.
	Induction. $n = 0$. For any $X :\bT$ , $ X \to X$ is a $W_0$-catlas, as $1 \in \bT = W_0$. If $X \in W_n$, it admits a $W_{n-1}$ catlas. By induction this is a $W_n$ catlas. So $X \in W_{n+1}$.
\end{proof}
\begin{lemma}{\label{prop:WnSigma}}
	For all $n : \bN$, $W_n$ covering stacks are $\sum$-stable. \\
\end{lemma}
\begin{proof}	
	Induction over $n$. If $n = 0$, then this is the stability under $\sum$ of $\bT$ \\
	If we wish to prove the statement for $n+1$, we may assume that $W_n$ covering stacks are $\sum$-stable. We have $\Zar \subset \bT \subset W_n$. So we can apply \ref{thm:atlasStableSum}. \\
\end{proof}	
\begin{prop}{\label{prop:WTrunc}}
	Every covering stack has $W_n$ for some $n$.
\end{prop}
\begin{proof}
	The idea is to apply \ref{prop:OneToRuleThemAll}.
	We need that $X \in W_n$ is a sheaf for $X$ a stack. \\
	Let $T \in \bT$ such that $T \to \exists (\bT \ni S \to X \ W_n \text{-atlas})$. We want to construct a $W_n$-catlas of $X$. By Zariski local choice we find a Zariski atlas $T' \to T$ with a term in 
	\[\prod_{t : T'} \sum_{S_t : \bT} W_n \mathsf{atlas} (S_t , X) \]
	 From this we obtain a map 
	 \[\sum_{t : T'} S_t \to T' \times X \to X\].  As $T' \in \bT \subset W_n$ by $\sum$-stability of $\bT$, both maps are $W_n$-covers. By $\ref{prop:WnSigma}$ the composite is a $W_n$-cover. Its domain is in $\bT$ by $\sum$-stability of $\bT$. This is what we wanted to show.
\end{proof}

\subsection{Stability}
\begin{theorem}{\label{thm:CSSum}}
	The class of covering / geometric stacks is $\sum$-stable.
\end{theorem}
\begin{proof}
	The geometric case follows from the covering case by \ref{thm:atlasStableSum}.
	Let $X$ be a covering stack and $B : X \to \CS$ a family of covering stacks.
	We apply \ref{prop:FindCommonN} to the predicate ' $X$ belongs to $W n$ for some $n$', which holds definitely for some $n$ by \ref{prop:WTrunc}.
	So we merely find an $n : \bN$ such that $B x \in W_n $ for all $x : X$. By making $n$ larger, we may assume $X$ has $W n$ for some $n$. Conclude by \ref{prop:WnSigma}\\


\end{proof}
\begin{lemma}{\label{lemma:coversstableundercomp}}
	geometric covers are stable under composition.
\end{lemma}
\begin{proof}
	covering stacks are stable under $\sum$.
\end{proof}


\begin{prop}{\label{prop:stackQuot}}
	The class of covering / geometric stacks is stable under quotients: If $X \to Y$ is fibered in covering stacks and $X$ is a (covering) stack and $Y$ is a stack then $Y$ is a covering / geometric stack.
\end{prop}
\begin{proof}
	Choose a geometric (c)atlas of $X$. Then the composition with the map $X \to Y$ is a cover by \ref{lemma:coversstableundercomp}. As the domain is (covering) affine, its a geometric (c)atlas.
\end{proof}
Now we want to show that the clash of terminology regarding 'covering' is reasonable:


\begin{prop}{\label{prop:affineCoveringStack}}
	Let $\bT$ be saturated.
	A covering stack $X$ is affine iff its a covering affine.
\end{prop}
\begin{proof}
	The converse is clear. The direct direction follows by the recursion principle. choosing a geometric catlas  $S \to X$. As both $S$ and $X$ are affine the fibers are affine. By induction the fibers are covering affines. By saturatedness of the topology $X$ is covering affine.
\end{proof}
\begin{lemma}{\label{lemma:atlasIsCatlas}}
	Let $\bT$ be saturated. Let $X$ be a covering stack. Let $f : \Spec A \to X$ be a geometric atlas. Then $\Spec A \in \bT$
\end{lemma}
\begin{proof}
	As $\Spec A \simeq \sum_{x : X} \fib_f x$ is a dependent sum of covering stacks, it is a covering stack again by \ref{thm:CSSum}. We conclude by \ref{prop:affineCoveringStack}.
\end{proof}	
\begin{lemma}{\label{lemma:geomStackPlusStable}}
	geometric stacks are stable under finite sums.
	If $\bT$ is finer than the zariski topology, then this holds for covering stacks as well
\end{lemma}
\begin{proof}
	We have to show that finite sums of geometric (c)atlasses are geometric (c)atlasses.
	For the geometric case just use that affines are stable under finite sums. For the covering case use that $1 + \hdots + 1 \in \Zar \subset \bT$, hence the topology is stable under finite sums.
\end{proof}
%\subsection{Geometric stacks}

\begin{lemma}{\label{lemma:geometricStacksClosedUnderId}}
	geometric stacks are closed under $\id$-types.
\end{lemma}
\begin{proof}
	
	This is \ref{lemma:havingAbstractAtlasClosedUnderId}, using that covering stacks are closed under $\sum$ (\ref{thm:CSSum})
\end{proof}

\begin{warning}
	The previous lemma does not hold for covering stacks: Identity types of things in $\bT$ could be empty.
\end{warning}

\subsection{About the covering stacks in a subuniverse}
\begin{definition}
	Let $\cV \supset \mathsf{Aff}$ be a superclass stable under $\sum$. covering $\cV$ stacks are the smallest intermediate class $\bT \subset \CS_\cV \subset \cV$ such that: If $X : \bT$ ,  $Y : \cV$ and $X \to Y$ is fibered in $\CS_\cV$, then $Y \in \CS_\cV$. \\
	$X$ is a geometric $\cV$-stack if its in $\cV$ and it merely admits a map $\Spec A \to X$ fibered in $\CS_\cV$.
\end{definition}
%We call such map $X \to Y$ whose fibers are covering $\cV$-stacks a geometric-$\cV$-cover. If $X$ is affine we call it an geometric-$\cV$ atlas. If $X$ is in $\bT$ we call it a geometric-$\cV$-catlas. 
\begin{definition}
	We define the saturation of $\bT$ as the class of covering Aff-stacks. We call a topology $\bT$ saturated if it coincides with its saturation, or more concretely: Every affine schemes that has a catlas lies itself in $\bT$. \\ 
\end{definition}
In a further chapter we will develop this theory further.



\begin{prop}{\label{prop:coveringVstackDescr}}
	Let $\cV$ be stable under finite limits and containing (covering) affines. $X$ is a (covering) $\cV$-stack iff it is in $\cV$ and a covering / geometric stack.
\end{prop}
\begin{proof} 	
	The direct direction is clear. For the converse we apply the recursion principle to the property '$X \in \cV$ implies $X$ is a (covering) $\cV$-stack'. If $X$ is contractible, its clear. Otherwise its equipped with a geometric (c)atlas. The fibers are in $\cV$, as they can be written as a fiberproduct of $S, X, 1 \in \cV$.  By induction all fibers are covering $\cV$-stacks (we may show the covering part of the proposition first). %We are left to show that $F$ is a covering $\cV$-stack. \\
	%	We can choose $S \to F$ a $\cV$-atlas, so in particular a geometric atlas of $F$, which was assumed to be a covering stack. Then $S \in \bT$ by \ref{lemma:atlasIsCatlas}. So we actually have a $\cV$-catlas.
\end{proof}
\begin{prop}{\label{prop:CSVSum}}
	(covering) $\cV$-stacks are stable under dependent sums. In particular the saturation of a topology defines a topology.
\end{prop}
\begin{proof}
	Both the classes $\cV$ and (covering) stacks are stable under dependent sums. Hence the intersection of them is $\sum$-stable as well. \\
	The saturation is a class of affines, that in particular contains $1 \in \bT$. We have argued its stable under $\sum$.
\end{proof}
\begin{prop}{\label{prop:V'stacks}}
	A stack $X$ merely admits some map $S \to X$ out of a (covering) affine fibered in covering $\cV$-stacks, iff its a covering / geometric stack whose identity types are in $\cV$. 
\end{prop}
\begin{proof}
	The direct direction: By \ref{lemma:havingAbstractAtlasClosedUnderId} the identity types are geometric $\cV$-stacks. \\
	The converse direction: Choose a geometric (c)atlas $f : S \to X$. As each fiber $\sum_{s : S} f s =_X x$ is in $V$ by $\sum$-stability of $\cV$ and is a covering stack, its a covering $\cV$-stack by \ref{prop:coveringVstackDescr}.
\end{proof}
\begin{definition}
	Let $n \ge -2$. A covering / geometric $n$-stack is a covering / geometric stack that is an $n$-type.
\end{definition}
\begin{prop}{\label{prop:nstack}}
	Let $X$ be a stack. For all $n \ge 0$, the following are equivalent:
	\begin{enumerate}
		\item $X$ is a covering / geometric $n+1$-stack
		\item $X$ merely admits some map $S \to X$ out of a (covering) affine fibered in covering $n$-stacks
		\item $X$ merely admits some covering / geometric $n$-stack $Y$ and a map $Y \to X$ fibered in covering $n$-stacks.
	\end{enumerate}
\end{prop}
\begin{proof}
	\
	\begin{enumerate}
		\item[1 . $\Leftrightarrow$ 2.]
		$X$ is a covering / geometric $n+1$ stack iff its a covering / geometric stack whose identity types are $n$-types. But this is equivalent to 2. by \ref{prop:V'stacks}.
%		\begin{align*}
%			& \text{$X$ is a covering / geometric $n+1$ stack} \\
%			&\overset{ \ref{lemma:geometricStacksClosedUnderId}} {\Leftrightarrow} \text{$X$ is a covering / geometric stack whose identity types are $n$-types} \\
%			&\overset{\ref{prop:V'stacks}} {\Leftrightarrow} \text{2.}
%		\end{align*}
		\item[2 . $\Rightarrow$ 3.]
		$S$ is a covering / geometric $n$-stack
		\item [3. $\Rightarrow$ 2]
		$Y$ admits a map $S \to Y$  fibered in covering $n$-stacks with $S$ (covering) affine, so the composition $S \to X$ will have the same property by \ref{lemma:coversstableundercomp}.
	\end{enumerate}
\end{proof}
\begin{prop}
	We have inclusions 
	\[W_n \subset \CS_{n} \subset W_{n+1}\]
\end{prop}
\begin{proof}
	
\end{proof}

\subsection{Truncatedness}
\begin{lemma}{\label{lemma:truncTrg}}
	Let $X$ be an $n+1$-type and $Y$ a stack. If $X \to Y$ is a $n$-truncated $\bT$-surjective map, then $Y$ is an $n+1$-type.
\end{lemma}
\begin{proof}
	Use that $\mathsf{is-n-truncated} (y=y')$ is a stack for $y , y' : Y.$
\end{proof}

\begin{corollary}
	Every geometric stack is $n$-truncated for some $n : \bN$.
\end{corollary}
\begin{proof}
	Apply the prop \ref{prop:OneToRuleThemAll}. Use \ref{lemma:truncTrg}. For a stack $X$, is-$n$-truncated $X$ is indeed a stack.
\end{proof}
