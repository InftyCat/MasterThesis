
\section{Covering stacks}
Fix $\bT$ a topology, which we call the covering-affines.
\begin{definition}
	Covering geometric stacks are the smallest class containing $\bT$ such that: If $Y$ is a sheaf and $\bT \ni S \to Y$ is fibered in covering geometric stacks, then $Y$ is a covering geometric stack.	
\end{definition}
We call such map $X \to Y$ whose fibers are covering stacks a geometric cover. If $X$ is affine we call it a geometric atlas. If $X$ is in $\bT$ we call it a geometric catlas. 
\begin{definition}
	We call $X$ a geometric stack if it merely has a geometric atlas, i.e some $\Spec A \to X$ fibered in covering geometric stacks.
\end{definition}
\begin{prop}[Recursion principle for (covering) geometric stacks]
	Let $P$ be a property of (covering) geometric stacks. Assume
	\begin{itemize}
		\item Every (covering) affine has $P$
		\item If $S$ is (covering) affine and $S \to Y$ is fibered in covering stacks having $P$ then $Y$ has $P$
	\end{itemize}
	Then every (covering) geometric stack has $P$.
\end{prop}
%\begin{proof}
%	Replace $P$ by $P \land \mathsf{is-covering-stack}$. Then usual induction
%	
%\end{proof}
\begin{why}
	Should $P$ be defined more generally for all sheaves?
	No, because we want for the recursion principle for geometric stacks, that the fibers are covering stacks (proof of truncatedness).
%	If $P$ is defined only for covering stacks, do we need to talk about $P$-covers between covering stacks without knowing that the fibers are covering stacks as well?
\end{why}


\begin{theorem}{\label{thm:CSSum}}
	The class of (covering) geometric stacks is $\sum$-stable.
\end{theorem}
\begin{proof}

	Define the predicate $P X$ as ' the sum of every family $B$ of (covering) geometric stacks is a (covering) geometric stack'.
	If $X$ is a (covering) affine, by choice of $X$ we can choose geometric catlasses $S_x \to B x$ for all $x : X$. Then $\sum_{x :X } S_x \to \sum_x B x$ is a geometric (c-)atlas. \\
	If $f : S \to X$ is a map fibered in $P$ with $S \in T$, then let $B : X \to \CS_\cV$. By choice of $S$ we can choose geometric catlasses $\tilde B s \to B (f s)$ for all $s : S$. Then consider $\sum_{s : S} \tilde B s \to \sum_{x : X} B x$. Its domain is (covering) affine. It remains to show, that the fiber over $(x,t)$ is a covering stack. It is a dependent sum over $\fib_f x$ by the explicit description in \ref{lemma:AtlasSum}, which by induction (we may prove the covering case of this theorem first) satisfies $P$ that lets us conclude by definition of $P$.
\end{proof}
\begin{lemma}{\label{lemma:coversstableundercomp}}
	geometric covers are stable under composition.
\end{lemma}
\begin{proof}
	covering stacks are stable under $\sum$.
\end{proof}

\begin{prop}{\label{prop:csHasAtlas}}
	Every covering geometric stack $X$ merely admits a geometric catlas. %, i.e. a geometric cover $Y \to X$ with $Y \in \bT$. 
\end{prop}

\begin{proof}
	%We apply the recursion principle of (covering) geometric stacks 
	\begin{itemize}
		\item If 	$X$ is covering affine, then $X \to X$ is a geometric catlas. 
		\item If $X$ is obtained as a quotient then it already is equipped with a catlas. %, i.e. if its equipped with a cover $Y \to X$ with $Y$ a covering stack, then by induction $Y$ admits a $\cV$-catlas $S \to Y$. Then $S \to Y \to X$ is a $\cV$-catlas by  \ref{lemma:coversstableundercomp}. \\
		%\item If $X$ is obtained as a sum, i.e. we have a $\cV$-cover $f : X \to Y$, then by induction $Y$ admits an $\cV$-catlas $g : S \to Y$ and the fibers merely have $\cV$-catlasses $S_y \to \fib_f y$ s. By choice of $S$, we can choose such catlasses $S_{g s} \to \fib_f (g s)$ for all $s : S$. By \ref{lemma:AtlasSum} the map 
		%\[
		%\sum_{s : S} S_{gs} \to (\sum_{y: Y} \fib_f y ) \simeq X
		%\]
		%is a $\cV$-cover. Its domain is a covering affine as $\bT$ is $\sum$-stable. Hence $X$ admits a $\cV$-catlas .
		
	\end{itemize}
\end{proof}
\begin{prop}{\label{prop:stackQuot}}
	The class of (covering) geometric stacks is stable under quotients: If $X \to Y$ is fibered in covering stacks and $X$ is a (covering) stack and $Y$ is a sheaf then $Y$ is a (covering) stack.
\end{prop}
\begin{proof}
	Choose a geometric (c)atlas of $X$. Then the composition with the map $X \to Y$ is a cover by \ref{lemma:coversstableundercomp}. As the domain is (covering) affine, its a geometric (c)atlas.
\end{proof}
Now we want to show that the clash of terminology regarding 'covering' is reasonable:


\begin{prop}{\label{prop:affineCoveringStack}}
	Let $\bT$ be saturated.
	A covering stack $X$ is affine iff its a covering affine.
\end{prop}
\begin{proof}
	The converse is clear. The direct direction follows by the recursion principle. choosing a geometric catlas  $S \to X$. As both $S$ and $X$ are affine the fibers are affine. By induction the fibers are covering affines. By saturatedness of the topology $X$ is covering affine.
\end{proof}
\begin{lemma}{\label{lemma:atlasIsCatlas}}
	Let $\bT$ be saturated. Let $X$ be a covering stack. Let $f : \Spec A \to X$ be a geometric atlas. Then $\Spec A \in \bT$
\end{lemma}
\begin{proof}
	As $\Spec A \simeq \sum_{x : X} \fib_f x$ is a dependent sum of covering stacks, it is a covering stack again by \ref{thm:CSSum}. We conclude by \ref{prop:affineCoveringStack}.
\end{proof}	

%\subsection{Geometric stacks}

\begin{lemma}{\label{lemma:geometricStacksClosedUnderId}}
	geometric stacks are closed under $\id$-types.
\end{lemma}
\begin{proof}
	
	This is \ref{lemma:havingAbstractAtlasClosedUnderId}, using that covering stacks are closed under $\sum$ (\ref{thm:CSSum})
\end{proof}

\begin{warning}
	The previous lemma does not hold for covering stacks: Identity types of things in $\bT$ could be empty.
\end{warning}

\subsection{About the covering stacks in a subuniverse}
\begin{definition}
	Let $\cV \supset \mathsf{Aff}$ be a superclass stable under $\sum$. covering geometric $\cV$ stacks are the smallest intermediate class $\bT \subset \CS_\cV \subset \cV$ such that: If $X : \bT$ ,  $Y : \cV$ and $X \to Y$ is fibered in $\CS_\cV$, then $Y \in \CS_\cV$. \\
	$X$ is a geometric $\cV$-stack if its in $\cV$ and it merely admits a map $\Spec A \to X$ fibered in $\CS_\cV$.
\end{definition}
%We call such map $X \to Y$ whose fibers are covering geometric $\cV$-stacks a geometric-$\cV$-cover. If $X$ is affine we call it an geometric-$\cV$ atlas. If $X$ is in $\bT$ we call it a geometric-$\cV$-catlas. 
\begin{definition}
	We define the saturation of $\bT$ as the class of covering Aff-stacks. We call a topology $\bT$ saturated if it coincides with its saturation, or more concretely: Every affine schemes that has a catlas lies itself in $\bT$. \\ 
\end{definition}
In a further chapter we will develop this theory further.



\begin{prop}{\label{prop:coveringVstackDescr}}
	Let $\cV$ be stable under finite limits and containing (covering) affines. $X$ is a (covering) $\cV$-stack iff it is in $\cV$ and a (covering) geometric stack.
\end{prop}
\begin{proof} 	
	The direct direction is clear. For the converse we apply the recursion principle to the property '$X \in \cV$ implies $X$ is a (covering) $\cV$-stack'. If $X \in \bT$, its clear. Otherwise its equipped with a geometric (c)atlas. The fibers are in $\cV$, as they can be written as a fiberproduct of $S, X, 1 \in \cV$.  By induction all fibers are covering $\cV$-stacks (we may show the covering part of the proposition first). %We are left to show that $F$ is a covering $\cV$-stack. \\
	%	We can choose $S \to F$ a $\cV$-atlas, so in particular a geometric atlas of $F$, which was assumed to be a covering geometric stack. Then $S \in \bT$ by \ref{lemma:atlasIsCatlas}. So we actually have a $\cV$-catlas.
\end{proof}
\begin{prop}{\label{prop:CSVSum}}
	(covering) $\cV$-stacks are stable under dependent sums. In particular the saturation of a topology defines a topology.
\end{prop}
\begin{proof}
	Both the classes $\cV$ and (covering) stacks are stable under dependent sums. Hence the intersection of them is $\sum$-stable as well. \\
	The saturation is a class of affines, that in particular contains $1 \in \bT$. We have argued its stable under $\sum$.
\end{proof}
\begin{prop}{\label{prop:V'stacks}}
	A sheaf $X$ merely admits some map $S \to X$ out of a (covering) affine fibered in covering $\cV$-stacks, iff its a (covering) geometric stack whose identity types are in $\cV$. 
\end{prop}
\begin{proof}
	The direct direction: By \ref{lemma:havingAbstractAtlasClosedUnderId} the identity types are geometric $\cV$-stacks. \\
	The converse direction: Choose a geometric (c)atlas $f : S \to X$. As each fiber $\sum_{s : S} f s =_X x$ is in $V$ by $\sum$-stability of $\cV$ and is a covering stack, its a covering $\cV$-stack by \ref{prop:coveringVstackDescr}.
\end{proof}
\begin{definition}
	Let $n \ge -2$. A (covering) geometric $n$-stack is a (covering) geometric stack that is an $n$-type.
\end{definition}
\begin{prop}
	Let $X$ be a sheaf. For all $n \ge 0$, the following are equivalent:
	\begin{enumerate}
		\item $X$ is a (covering) geometric $n+1$-stack
		\item $X$ merely admits some map $S \to X$ out of a (covering) affine fibered in covering $n$-stacks
		\item $X$ merely admits some (covering) geometric $n$-stack $Y$ and a map $Y \to X$ fibered in covering $n$-stacks.
	\end{enumerate}
\end{prop}
\begin{proof}
	\
	\begin{enumerate}
		\item[1 . $\Leftrightarrow$ 2.]
		$X$ is a (covering) geometric $n+1$ stack iff its a (covering) geometric stack whose identity types are $n$-types. But this is equivalent to 2. by \ref{prop:V'stacks}.
%		\begin{align*}
%			& \text{$X$ is a (covering) geometric $n+1$ stack} \\
%			&\overset{ \ref{lemma:geometricStacksClosedUnderId}} {\Leftrightarrow} \text{$X$ is a (covering) geometric stack whose identity types are $n$-types} \\
%			&\overset{\ref{prop:V'stacks}} {\Leftrightarrow} \text{2.}
%		\end{align*}
		\item[2 . $\Rightarrow$ 3.]
		$S$ is a (covering) geometric $n$-stack
		\item [3. $\Rightarrow$ 2]
		$Y$ admits a map $S \to Y$  fibered in covering $n$-stacks with $S$ (covering) affine, so the composition $S \to X$ will have the same property by \ref{lemma:coversstableundercomp}.
	\end{enumerate}
\end{proof}
\subsection{Truncatedness}
In this subsection we want to prove that every geometric stack is a geometric $n$-stack for some $n$.

\begin{lemma}{\label{lemma:cstinh}}
	Every covering $\cV$-stack $X$ is $\bT$-merely inhabited.
\end{lemma}
\begin{proof} 
	\begin{itemize}
		\item If $X$ is in $\bT$ then its clear.
		\item  If $X$ is obtained by a quotient, we have a map $\Spec A \to X$ with domain in $\bT$. Now use that we get a map on $\bT$-propositional-truncations and that Spec A is T-merely inhabited.
		%		\item if $X$ is obtained by  $X = \sum_{y: Y} B y$ for $Y$ a covering $\cV$-stack and $B y$ covering $\cV$-stacks, by induction all the $B y$ are $\bT$-merely inhabited. Hence, for all $y : Y$, we can conclude $\| X\|_\bT$. As $Y$ is $\bT$-merely inhabited by induction and the goal is a sheaf, we can conclude. 
	\end{itemize}
\end{proof}
\begin{lemma}{\label{lemma:truncTrg}}
	Let $X$ be an $n+1$-type and $Y$ a sheaf. If $X \to Y$ is a $n$-truncated $\bT$-surjective map, then $Y$ is an $n+1$-type.
\end{lemma}
\begin{proof}
	Use that $\mathsf{is-n-truncated} (y=y')$ is a sheaf for $y , y' : Y.$
\end{proof}
\begin{theorem}
	Every geometric stack is $n$-truncated for some $n : \bN$.
\end{theorem}
\begin{proof}
	We apply the recursion principle for geometric stacks.
	\begin{itemize}
		\item If $Y$ is affine its clear with $n = 0$.
		\item Assume $Y$ is equipped with a $\cV$-atlas $f : S \to Y$, such that every fiber in $n$-truncated for some $n$. f is $\bT$-surjetive by \ref{lemma:cstinh}.
		We apply \ref{lemma:truncTrg}.
		So it remains to find an $n$ such that all fibers are $n$-truncated.
		For any $x : S$, By induction $\fib_f (f x)$ is $n$-truncated for some $n$. By projectivity of $S$, we find some $n$ such that $\fib_f (f x)$ is $n$-truncated for all $x : S$. For general $y : Y$, using that is-$n$-truncated $\fib_f y$ is a sheaf , we can conclude by $\bT$-surjectivity of $f$.
		%	\item Let $X$ be an $n$-truncated covering geometric stack. By \ref{prop:csHasAtlas} we find a geometric catlas $S \to X$. All the fibers are (at most) $n$-truncated. 
	\end{itemize}
	
	%
	
\end{proof}